# Morgan Edition 작업 로그

## 2026-02-03 (월)

### 완료된 작업

#### Phase 3: 캐릭터 시스템 - 완료

**3.1 캐릭터 관리 페이지 (CRUD)**
- `bbs/character.php` - 내 캐릭터 목록
- `bbs/character_form.php` - 캐릭터 생성/수정 폼
- `bbs/character_form_update.php` - 폼 처리
- `bbs/character_view.php` - 캐릭터 프로필 보기
- `data/character/` 디렉토리 생성

**3.2 캐릭터 목록/프로필**
- `bbs/character_list.php` - 전체 캐릭터 목록 (검색/필터/정렬)

**3.3 캐릭터 선택기 (게시판 연동)**
- `install.sql`에 `mg_write_character` 테이블 추가
- `morgan.php`에 헬퍼 함수 추가:
  - `mg_get_write_character()` - 글에 연결된 캐릭터 조회
  - `mg_set_write_character()` - 글-캐릭터 연결 저장
  - `mg_get_usable_characters()` - 사용 가능한 캐릭터 목록
- `write.skin.php` - 글 작성 시 캐릭터 선택 UI
- `view.skin.php` - 글 보기에서 캐릭터 정보 표시
- `list.skin.php` - 목록에서 캐릭터 정보 표시
- `view_comment.skin.php` - 댓글 캐릭터 선택 및 표시
- `morgan.extend.php` - write_update_after, comment_update_after 훅

**3.4 캐릭터 승인 관리 (관리자 페이지)**
- `adm/admin.menu400.php` - Morgan 관리 메뉴
- `adm/mg_character_list.php` - 캐릭터 목록 (상태별 필터, 검색)
- `adm/mg_character_form.php` - 캐릭터 상세/승인/반려
- `adm/mg_character_update.php` - 개별 액션 처리
- `adm/mg_character_list_update.php` - 일괄 액션 처리
- `adm/mg_side_list.php` - 세력/종족 관리
- `adm/mg_side_update.php` - 세력/종족 저장
- `adm/mg_profile_field_list.php` - 프로필 양식 목록
- `adm/mg_profile_field_form.php` - 프로필 양식 상세
- `adm/mg_profile_field_update.php` - 프로필 양식 저장
- `adm/mg_config.php` - Morgan 설정

#### 기타 수정
- "캐릭터 도감" → "캐릭터 목록"으로 명칭 변경 (`head.php`)

---

### 내일 작업 예정

#### 1. SPA-like 네비게이션 전환 (중요!)

**현재 문제:**
- 메뉴 클릭 시 전체 페이지가 새로고침됨
- BGM, 웹소켓 등 유지해야 할 연결이 끊어짐

**목표:**
- 메뉴 클릭 → AJAX로 콘텐츠 요청 → `#main-content` 영역만 교체
- 헤더, 사이드바, 위젯 등은 페이지 이동 시에도 유지
- `history.pushState()`로 URL 변경 (뒤로가기 지원)

**구현 방안:**
- 게시판 등 복잡한 페이지는 헤더/푸터 제외하고 페이지 자체를 불러와서 main-content에 삽입
- AJAX 요청 감지하여 헤더/푸터 출력 제어

**필요 작업:**
1. `head.sub.php` - AJAX 요청 감지 로직
2. `head.php`, `tail.php` - 출력 제어
3. JavaScript 라우터 작성
4. 폼 제출 AJAX 처리
5. 기존 페이지 테스트

---

#### 2. 세계관 관리 기능

**관리자:**
- 레프트 메뉴 2뎁스 형식으로 추가
- 세계관 관리 메뉴 (일반 목록형 게시판)

**프론트:**
- 왼쪽 사이드바에 세계관 메뉴
- 클릭 시 게시판 게시글 제목 목록 표시
- 각 제목 클릭 → 해당 뷰페이지로 연결

---

#### 3. 메인 페이지 대문 커스터마이징

**현재:** 대시보드 형태

**목표:**
- 관리자가 직접 대문을 디자인/구성 가능
- `mg_config`에 대문용 에디터 컬럼 추가
- 관리자 페이지에서 HTML/에디터로 편집

---

#### 4. UI 수정 확인

- 캐릭터 본문 빈 상태 padding 확인 (사용자가 지적한 부분 재확인 필요)

---

### 전체 진행 상황

| Phase | 내용 | 상태 |
|-------|------|------|
| 1 | 기본 구조 및 테마 | ✅ 완료 |
| 2 | 데이터베이스 스키마 | ✅ 완료 |
| 3 | 캐릭터 시스템 | ✅ 완료 |
| - | SPA-like 네비게이션 | 🔜 다음 |
| - | 세계관 관리 | 📋 예정 |
| - | 메인 대문 커스터마이징 | 📋 예정 |
| 4 | TRPG 스탯 시스템 | 📋 예정 (CMS 완료 후) |

---

### 메모

- TRPG 스탯 시스템은 CMS 기본 기능 완료 후 진행
- 멀티 룰셋 지원 (CoC, D&D, VtM) 설계는 완료됨 (`PLAN_DB.md` 참고)
- 경험치 시스템 제거, 포인트 경제로 대체
