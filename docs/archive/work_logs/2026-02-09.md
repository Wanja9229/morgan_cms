# 작업 로그 - 2026-02-09

## 완료 항목

### 1. 역극 댓글 이미지 첨부 기능

#### 1.1 서버 측 (bbs/rp_reply.php)
- 이미지 업로드 처리 추가: 확장자 검증(jpg/jpeg/png/gif/webp), `data/rp/` 저장
- 이미지 첨부 시 내용(텍스트) 없이도 전송 허용
- 기존 `!$rr_content` 필수 조건 → `(!$rr_content && !$has_image)` 조건으로 변경

#### 1.2 최소 글자수 조건 변경 (plugin/morgan/morgan.php)
- `mg_create_rp_reply()`: 이미지 첨부 시 최소 글자수 체크 건너뜀
- 조건: 내용이 있으면서 짧고 이미지도 없을 때만 차단

#### 1.3 프런트엔드 (theme/morgan/skin/rp/list.skin.php)
- PHP 메신저 폼 + 하단 기본 폼: 이미지 아이콘 버튼 + 미리보기 영역 추가
- JS `buildReplyFormHtml()`: 동적 생성 폼에도 동일하게 이미지 첨부 UI 추가
- JS 전송 핸들러: FormData에 `rr_image` 파일 첨부, 성공 후 초기화
- JS 이미지 미리보기: FileReader로 썸네일 표시, 5MB 크기 제한
- JS 미리보기 제거 버튼: X 클릭 시 파일 입력 초기화

#### 1.4 이미지 원본 보기 모달
- 댓글 이미지 + 스레드 본문 이미지 클릭 시 원본 크기 모달 표시
- 90vw/90vh 내 object-contain, 배경 블러
- X 버튼 화면 우측 상단 고정, ESC/배경 클릭으로 닫기
- DOM에 동적 생성 (최초 클릭 시 1회)

---

### 2. 참여자 하단 폼 중복 방지

- 이미 역극에 참여 중인 유저(`$is_already_joined`)는 하단 일반 댓글 폼 숨김
- 자기 캐릭터의 메신저 탭에서만 댓글 작성 가능
- 조건 순서 변경: `$is_already_joined` 체크를 `$is_full` 앞으로 이동

---

### 3. 관리자 권한 추가

#### 3.1 댓글 삭제 (모든 댓글)
- JS: `canEdit`(수정=본인만)과 `canDelete`(삭제=본인+관리자) 분리
- `rp_api.php` `delete_reply`: `$is_admin === 'super'` 조건 추가
- 수정 버튼은 본인에게만, 삭제 버튼은 본인+관리자에게 표시

#### 3.2 판(스레드) 삭제
- list.skin.php: 관리자에게만 "삭제" 버튼 표시 (완결 버튼 옆)
- `rp_api.php`: `delete_thread` 액션 신규 추가
  - 관리자만 실행 가능 (`$is_admin === 'super'`)
  - 댓글 → 참여자 → 스레드 순서로 완전 삭제
- JS `deleteThread()`: 확인 후 AJAX 삭제, DOM에서 카드 제거

---

### 4. 메신저 영역 높이 확장

- `.max-h-80` → `.max-h-120` (PHP 렌더링 + JS 동적 생성 모두)

---

### 5. 기타 확인 사항

#### 5.1 new.php (새글) 기능 확인
- Gnuboard5 기본 기능: `g5_board_new` 테이블 기반 전체 게시판 최신글 모아보기
- 알림(종모양)과는 완전 별개 기능
  - new.php: 전체 공개 활동 피드
  - 알림: 개인별 이벤트 알림 (`mg_notification` 테이블)
- **현재 보류** — 사용 예정 없음

#### 5.2 상점 꾸미기 아이템 적용 가능성 판정
- 결론: 현재 구조에서 모두 적용 가능
- 상세 기획은 `docs/plans/SHOP.md` 12절에 기록

---

## 수정 파일 목록

| 파일 | 작업 |
|------|------|
| `bbs/rp_reply.php` | 이미지 업로드 처리, 이미지 전용 전송 허용 |
| `bbs/rp_api.php` | 관리자 댓글 삭제 권한, `delete_thread` 액션 추가 |
| `plugin/morgan/morgan.php` | 이미지 첨부 시 최소 글자수 체크 스킵 |
| `theme/morgan/skin/rp/list.skin.php` | 이미지 첨부 UI, 미리보기, 원본 모달, 관리자 버튼, 참여자 폼 중복 방지, 메신저 높이 확장 |

---

## 관련 문서

- `docs/plans/SHOP.md` - 상점 기획 (12절: 꾸미기 아이템 확장 기획 추가)

---

*작성일: 2026-02-09*
