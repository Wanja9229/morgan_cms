# 작업 로그 - 2026-02-06

## 완료 항목

### 1. Git 저장소 연결 및 초기화

#### 1.1 저장소 설정
- 저장소 URL: https://github.com/Wanja9229/morgan_cms
- 기존 내용 덮어쓰기 (force push)
- 초기 커밋: 2525 files, 458938 insertions

#### 1.2 .gitignore 업데이트
```
# Claude Code
.claude/

# Windows special files
nul
NUL
```
- Windows `nul` 특수 파일 문제 해결

---

### 2. 개발 환경 문서화

#### 2.1 docs/SETUP.md 신규 생성
집에서도 작업 가능하도록 로컬 환경 설정 가이드 작성:

| 항목 | 내용 |
|------|------|
| Docker 컨테이너 | nginx:8080, php-fpm:9000, mysql:3307, phpmyadmin:8081 |
| DB 정보 | morgan_db / morgan_user / morgan_pass |
| Node.js | 18+ (Tailwind CSS 빌드용) |
| CSS 빌드 | `npm run css:watch` / `npm run css:build` |

#### 2.2 새 환경 세팅 순서
```bash
git clone https://github.com/Wanja9229/morgan_cms new_cms
cd new_cms
npm install
docker-compose up -d --build
npm run css:build
# http://localhost:8080
```

---

### 3. 2-depth 사이드바 메뉴 버그 수정

#### 3.1 문제점
1. 게시판/역극 페이지 진입 시 2-depth 메뉴가 자동으로 열림
2. 역극 페이지에서 이전에 방문한 게시판 하이라이트가 남아있음

#### 3.2 해결 (theme/morgan/js/app.js)
```javascript
// 변경 전
if (isCommunity) {
    window.MG_BoardPanel.open(); // 자동 열림
}

// 변경 후
if (isCommunity) {
    // 패널은 자동으로 열지 않음 - 사용자가 클릭해야 열림
}
```

```javascript
// 변경 전
if (isCommunity && boTable) { ... }

// 변경 후
if (isCommunity) {
    // boTable 없으면 모든 게시판 하이라이트 제거 (RP 페이지 등)
    var isActive = boTable && linkHref.indexOf('bo_table=' + boTable) !== -1;
}
```

---

### 4. 역극(RP) UI 재설계 기획

#### 4.1 핵심 변경: View 페이지 제거
- 기존: list.php → view.php (별도 페이지)
- 변경: list.php에서 모든 것 처리 (View in List 패턴)

#### 4.2 새 UI 구조
```
[역극 목록 페이지]
┌─────────────────────────────────────┐
│ [역극 제목]                          │
│ 본문 전체 내용 표시                   │
│                                     │
│ ─────────────────────────────────── │
│ 참여자 목록 (세로 나열)               │
│ ┌─ 캐릭터A ────────────────────────┐ │
│ │ [펼쳐진 메신저 창]                │ │
│ │ - 대화 내용들...                  │ │
│ │ - 입력창                         │ │
│ └──────────────────────────────────┘ │
│ ┌─ 캐릭터B (접힌 상태) ─────────────┐ │
│ └──────────────────────────────────┘ │
│ ┌─ 캐릭터C (접힌 상태) ─────────────┐ │
│ └──────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 4.3 참여자 메신저 창 동작
- 참여자별로 독립적인 메신저 창
- 여러 참여자 창 동시 열기 가능
- 클릭 시 해당 참여자 아래에 메신저 창 토글

#### 4.4 용어 변경
| 기존 | 변경 |
|------|------|
| 판장 | 작성자 |
| 판 세우기 | 새 글 / 글쓰기 |

#### 4.5 완결 판정 변경 (추후 수정 예정)
- 현재: 역극 단위 완결 (`mg_rp_thread.rt_status`)
- 변경 예정: 참여자(메신저) 단위 완결 (`mg_rp_member.rm_status`)
- 이유: 같은 역극 내에서도 참여자별로 완결 시점이 다를 수 있음

---

### 5. 메모 스킨 기획

#### 5.1 View in List 패턴 적용
- 역극과 동일하게 view 페이지 제거
- list에서 본문 + 댓글 모두 표시

#### 5.2 역극과의 차이점
| 항목 | 역극 | 메모 |
|------|------|------|
| 댓글 UI | 참여자별 메신저 창 | 일반 댓글 목록 |
| 멀티 창 | O (여러 참여자 동시) | X (단일 목록) |
| 완결 기능 | O | X |

---

## 수정 파일 목록

| 파일 | 작업 |
|------|------|
| `.gitignore` | Windows nul 파일 추가, .claude/ 추가 |
| `docs/SETUP.md` | **신규** - 개발 환경 설정 가이드 |
| `docs/plans/BOARD.md` | 역극/메모 UI 재설계 내용 반영 |
| `theme/morgan/js/app.js` | 2-depth 메뉴 자동열림/포커싱 버그 수정 |
| `theme/morgan/skin/rp/list.skin.php` | owner 필터, 본문 미리보기 추가 |
| `bbs/rp_list.php` | owner 파라미터 처리 추가 |

---

## 향후 작업 참고사항

### 역극 UI 구현 시 주의점

1. **SPA 라우터 호환**
   - view 페이지 제거 시 `app.js`의 `updateSidebar()` 매핑 수정 필요
   - `rp_view.php` 관련 코드 제거

2. **메신저 창 상태 관리**
   - 여러 창 동시 열기 → 배열로 열린 참여자 ID 관리
   - localStorage로 상태 유지 고려 (페이지 새로고침 시)

3. **댓글 작성 AJAX 처리**
   - 현재 `rp_reply.php`가 form submit 방식
   - View in List 패턴에서는 AJAX로 변경 필요

4. **완결 상태 마이그레이션**
   - `mg_rp_member` 테이블에 `rm_status` 컬럼 추가 예정
   - 기존 데이터 마이그레이션 스크립트 필요

### 메모 스킨 구현 시 참고

1. **기존 스킨 파일 구조**
   - `theme/morgan/skin/board/memo/` 경로 사용 예정
   - `list.skin.php` 하나로 통합

2. **댓글 로딩**
   - 글별로 댓글 전체 로딩 vs 페이징
   - 글이 많은 경우 성능 고려

### Git 워크플로우

```bash
# 작업 시
git pull origin main
# ... 작업 ...
git add <files>
git commit -m "메시지"
git push origin main
```

---

## 관련 문서

- `docs/SETUP.md` - 개발 환경 설정
- `docs/plans/BOARD.md` - 게시판/역극/메모 기획
- `docs/CORE.md` - 핵심 참조

---

*작성일: 2026-02-06*
