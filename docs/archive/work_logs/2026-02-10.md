# 작업 로그 - 2026-02-10

## 완료 항목

### 1. Phase 14: 인장 시스템 (Seal / Signature Card) - 전체 완료

게시글·역극 하단에 자동 표시되는 유저 시그니처 카드. 인벤 인장 스타일.

#### 1.1 DB + 테이블 등록 + 설정값
- `mg_seal` 테이블 생성 (seal_id, mb_id, seal_use, seal_tagline, seal_content, seal_image, seal_link, seal_link_text, seal_text_color, seal_update)
- `install.sql`에 CREATE TABLE + ALTER TABLE(si_type enum에 seal_bg, seal_frame 추가) 반영
- `morgan.php`에 `$g5['mg_seal_table']`, `$mg['seal_table']` 등록
- `MG_SEAL_IMAGE_PATH`, `MG_SEAL_IMAGE_URL` 상수 추가
- mg_config 기본값 11개 삽입 (seal_enable, seal_tagline_max, seal_content_max 등)
- `mg_use_item()` exclusive_types에 `seal_bg`, `seal_frame` 추가

#### 1.2 핵심 함수 (plugin/morgan/morgan.php)
- `mg_get_seal($mb_id)` — 인장 데이터 + 회원 + 대표 캐릭터 + 칭호 + 스킨 + 트로피 통합 조회
- `mg_render_seal($mb_id, $mode)` — full/compact HTML 렌더링 (static 캐싱)
- `mg_upload_seal_image($file, $mb_id)` — 이미지 업로드 (확장자/크기 검증, 리사이즈)
- `mg_resize_image($source, $dest, $max_w, $max_h)` — GD 기반 이미지 리사이즈
- `mg_sanitize_seal_text($text, $max_len)` — 텍스트 새니타이징

#### 1.3 유저 편집 페이지
- `bbs/seal_edit.php` — 인장 편집 폼 (ON/OFF, 한마디, 자유영역, 이미지, 링크, 텍스트색, 트로피, 실시간 미리보기)
- `bbs/seal_edit_update.php` — AJAX 저장 (INSERT...ON DUPLICATE KEY UPDATE)
- `bbs/seal_image_upload.php` — AJAX 이미지 업로드/삭제

#### 1.4 렌더링 삽입 (기존 파일 수정)
- `theme/morgan/skin/board/basic/view.skin.php` — 글 하단 인장 (full)
- `theme/morgan/skin/board/postit/view.skin.php` — 동일 패턴
- `bbs/character_view.php` — 캐릭터 프로필 하단 인장 (full)
- `bbs/rp_api.php` — reply 데이터에 `seal_html` 추가 (per-user 캐싱)
- `theme/morgan/skin/rp/list.skin.php` — RP 이음 버블 하단에 compact 인장

#### 1.5 관리자
- `adm/morgan/seal.php` — 인장 관리 (목록, 검색, 모달 미리보기, 강제 OFF/ON/초기화/삭제)
- `adm/admin.menu800.php` — '인장 관리' 메뉴 추가 (ID 801300, 그룹 '인장')
- `adm/morgan/config.php` — 인장 설정 섹션 추가 (11개 설정)
- `adm/morgan/config_update.php` — seal 설정키 10개 추가

---

### 2. 마이 페이지 (My Page) 생성

기존에 흩어져 있던 유저 기능을 한 페이지에 모은 허브 페이지.

#### 2.1 마이 페이지 (bbs/mypage.php)
- 프로필 헤더: 아바타, 닉네임, 칭호, 레벨, 포인트, 캐릭터 수, 출석 연속일, 업적 진행률
- 대표 캐릭터 카드 + 관리 링크
- 내 인장 미리보기 (compact) + 편집 링크
- 업적: 쇼케이스 + 최근 진행 업적 4개 (프로그레스바)
- 인벤토리: 최근 아이템 8개 그리드
- 선물함: 미수령 선물 5개
- 바로가기: 출석, 인장편집, 업적, 알림, 쪽지, 스크랩, 포인트내역, 회원정보수정

#### 2.2 사이드바 변경 (theme/morgan/head.php)
- 인장 아이콘 → 마이 페이지 아이콘으로 교체
- mypage.php, seal_edit.php에서 활성 표시

---

### 3. 업적 테스트 데이터 인코딩 수정

- 원인: 이전 세션에서 INSERT 시 `--default-character-set=utf8mb4` 미지정 → Latin1 인코딩으로 저장
- 수정: 4개 테이블 데이터 전체 삭제 후 utf8mb4로 재삽입
  - mg_achievement: 10개 업적
  - mg_achievement_tier: 23개 티어
  - mg_user_achievement: 17개 진행 기록
  - mg_user_achievement_display: 2개 쇼케이스

---

## 수정 파일 목록

| 파일 | 작업 |
|------|------|
| `plugin/morgan/install/install.sql` | mg_seal CREATE TABLE, ALTER si_type |
| `plugin/morgan/morgan.php` | 테이블 등록, 상수, 인장 함수 5개, mg_use_item 수정 |
| `bbs/seal_edit.php` | **신규** — 인장 편집 폼 |
| `bbs/seal_edit_update.php` | **신규** — 인장 저장 AJAX |
| `bbs/seal_image_upload.php` | **신규** — 인장 이미지 업로드 AJAX |
| `bbs/mypage.php` | **신규** — 마이 페이지 허브 |
| `bbs/character_view.php` | 캐릭터 프로필 하단 인장 삽입 |
| `bbs/rp_api.php` | reply 데이터에 seal_html 추가 |
| `theme/morgan/skin/board/basic/view.skin.php` | 글 하단 인장 삽입 |
| `theme/morgan/skin/board/postit/view.skin.php` | 글 하단 인장 삽입 |
| `theme/morgan/skin/rp/list.skin.php` | RP 이음에 compact 인장 삽입 |
| `theme/morgan/head.php` | 사이드바 마이 페이지 아이콘, 페이지 감지 변수 |
| `adm/admin.menu800.php` | 인장 관리 메뉴 추가 |
| `adm/morgan/seal.php` | **신규** — 관리자 인장 관리 |
| `adm/morgan/config.php` | 인장 설정 섹션 추가 |
| `adm/morgan/config_update.php` | seal 설정키 추가 |
| `docs/ROADMAP.md` | Phase 14 완료 반영 |
| `docs/CORE.md` | Phase 14 완료, DB/파일 인덱스 업데이트 |

---

## 관련 문서

- `docs/plans/SEAL.md` — 인장 시스템 기획서

---

*작성일: 2026-02-10*
