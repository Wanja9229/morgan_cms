# 게시판 시스템 기획

> **구현 완료** (Phase 6/11)

> Morgan Edition - 게시판 시스템 설계
> 기반: 그누보드5 게시판 + 커뮤니티 특화 확장

> ⚠️ **스키마 참조**: 최종 테이블 구조는 [DB.md](./DB.md) 참조
> 이 문서의 테이블명은 설계 참고용이며, 실제 구현 시 mg_ 접두사 사용
> (예: rp_thread → mg_rp_thread, rp_reply → mg_rp_reply)

---

## 개요

- **기본 게시판**: 그누보드5 기반, 스킨으로 확장
- **역극 게시판**: 별도 테이블/시스템으로 독립 설계
- **UI**: Tailwind CSS, 디스코드 스타일 다크 테마

---

## 1. 기본 게시판 시스템

### 1.1 그누보드5 게시판 유지 항목

| 항목 | 유지 | 비고 |
|------|------|------|
| 게시판 생성/관리 | O | |
| 게시판 그룹 | O | |
| 글 작성/수정/삭제 | O | |
| 댓글 | O | |
| 파일 첨부 | O | |
| 비밀글 | O | 제한적 사용 |
| 익명글 | O | 제한적 사용 |
| 추천/비추천 | O | |
| 스킨 시스템 | O | 확장성 핵심 |

### 1.2 제거 항목

| 항목 | 제거 이유 |
|------|----------|
| 임시저장 | DB/호스팅 비용 절감 |
| 투표 | 불필요 |
| 링크 | 불필요 |
| SNS 공유 | 불필요 |

### 1.3 스킨 타입

| 스킨 | 설명 | 용도 | View 페이지 |
|------|------|------|-------------|
| basic | 목록형 (기본) | 공지사항, 일반 게시판 | O (별도 페이지) |
| gallery | 갤러리형 | 로그, 창작물 | O (모달 or 페이지) |
| memo | 메모형 | 문의, 오너게시판 | **X (List에서 처리)** |
| postit | 포스트잇형 | 앓이란 | X (모달) |

---

## 2. 역극 게시판 (별도 시스템)

### 2.1 개요

- 기존 게시판/댓글 구조가 아닌 **독립 테이블**
- **View 페이지 없음** - List에서 모든 것 처리
- 캐릭터 연동 필수

### 2.2 역극 테이블 (mg_rp_thread)

| 필드 | 타입 | 설명 |
|------|------|------|
| rt_id | int AUTO_INCREMENT | PK |
| rt_title | varchar(200) | 제목 |
| rt_content | text | 시작글 내용 |
| rt_image | varchar(500) | 첨부 이미지 (선택) |
| mb_id | varchar(20) | 작성자 회원 ID |
| ch_id | int | 작성자 캐릭터 ID |
| rt_max_member | int | 최대 참여자 수 (0=무제한) |
| rt_status | enum | 상태 (open/closed/deleted) |
| rt_datetime | datetime | 생성일 |
| rt_update | datetime | 최근 활동일 |
| rt_reply_count | int | 이음 수 |

### 2.3 역극 이음 테이블 (mg_rp_reply)

| 필드 | 타입 | 설명 |
|------|------|------|
| rr_id | int AUTO_INCREMENT | PK |
| rt_id | int | 역극 ID (FK) |
| rr_content | text | 이음 내용 |
| rr_image | varchar(500) | 첨부 이미지 (선택) |
| mb_id | varchar(20) | 작성자 회원 ID |
| ch_id | int | 작성 캐릭터 ID |
| rr_datetime | datetime | 작성일 |

### 2.4 역극 참여자 테이블 (mg_rp_member)

| 필드 | 타입 | 설명 |
|------|------|------|
| rm_id | int AUTO_INCREMENT | PK |
| rt_id | int | 역극 ID |
| mb_id | varchar(20) | 참여자 회원 ID |
| ch_id | int | 참여 캐릭터 ID |
| rm_datetime | datetime | 참여 시작일 |
| rm_reply_count | int | 해당 역극 내 이음 수 |

### 2.5 역극 UI 레이아웃 (List 기반)

**핵심: View 페이지 없음, List에서 모든 것 처리**

```
┌─────────────────────────────────────────────────────────────┐
│  [+ 새 글]  ← 모달로 작성                                    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  [제목]                                  [open] [작성자 정보] │
├─────────────────────────────────────────────────────────────┤
│  시작글 본문 **전체** 표시                                    │
│  (요약 없음, nl2br로 줄바꿈 유지)                             │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  참여자:                                                    │
│  ├─ [캐릭A 아이콘] 캐릭A (이음 3개) ▼  ← 클릭 시 하단 열림    │
│  │  ┌───────────────────────────────────────────────────┐  │
│  │  │ [A] 이음 내용 1...                       10분 전  │  │
│  │  │ [A] 이음 내용 2...                        5분 전  │  │
│  │  │ [A] 이음 내용 3...                        방금 전 │  │
│  │  └───────────────────────────────────────────────────┘  │
│  │                                                         │
│  ├─ [캐릭B 아이콘] 캐릭B (이음 5개) ▼  ← 동시에 여러 개 열기 │
│  │  ┌───────────────────────────────────────────────────┐  │
│  │  │ [B] 이음 내용 1...                                │  │
│  │  │ [B] 이음 내용 2...                                │  │
│  │  │ ...더보기 (3개 더)                                │  │
│  │  └───────────────────────────────────────────────────┘  │
│  │                                                         │
│  └─ [캐릭C 아이콘] 캐릭C (이음 2개) ▶  ← 접힌 상태           │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  [캐릭터▼] [이음 입력창...] [이음]      ← 인라인 입력        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  [제목]                                  [open] [작성자 정보] │
├─────────────────────────────────────────────────────────────┤
│  시작글 본문 전체                                            │
├─────────────────────────────────────────────────────────────┤
│  참여자: 없음                                                │
│  [참여하기] 버튼                         ← 참여자 없을 때     │
├─────────────────────────────────────────────────────────────┤
│  [캐릭터▼] [이음 입력창...] [이음]                           │
└─────────────────────────────────────────────────────────────┘

... 다음 글 ...
```

### 2.6 역극 상태별 처리

**현재 (임시):**
| 상태 | 표시 | 입력창 | 비고 |
|------|------|--------|------|
| open | 본문 + 참여자 메신저 | O | 진행 중 |
| closed | 본문 + 참여자 메신저 | X (숨김) | 완결됨 표시 |
| deleted | 표시 안함 | - | 목록에서 제외 |

**추후 변경 예정: 참여자(메신저) 단위 완결**
- 역극 전체가 아닌, **각 참여자(캐릭터)별로 완결 판정**
- 예: 캐릭A와의 대화는 완결, 캐릭B와의 대화는 진행 중
- mg_rp_member 테이블에 `rm_status` 컬럼 추가 필요
- 모든 참여자가 완결되면 역극 전체도 자동 완결 처리

### 2.7 역극 플로우

```
1. 작성자가 역극 생성 (모달)
   - 캐릭터 선택 (기본: main 캐릭터)
   - 제목 + 시작글 작성
   - 최대 참여자 설정 (선택)

2. 참여자가 이음 작성
   - 캐릭터 선택 (기본: main 캐릭터)
   - 내용 작성 + 이미지 첨부 (선택)
   - fetch로 실시간 추가

3. 이음 표시
   - 참여자별로 그룹핑 (세로 나열)
   - 각 참여자 클릭 시 해당 캐릭터의 이음만 메신저 창으로 펼침
   - 여러 참여자 동시 열기 가능

4. 완결 처리
   - 작성자가 수동으로 완결 버튼 클릭
   - rt_status = 'closed'로 변경
   - 입력창만 숨김, 내용은 계속 열람 가능
```

### 2.8 역극 제한 기능 (관리자 설정)

| 설정 | 설명 |
|------|------|
| cf_rp_require_reply | 새 글 작성 전 이어야 할 역극 수 |
| cf_rp_max_member_default | 기본 최대 참여자 수 |
| cf_rp_max_member_limit | 최대 참여자 상한선 |
| cf_rp_content_min | 최소 글자 수 |
| cf_rp_image_required | 이미지 필수 여부 |

---

## 3. 메모 스킨 (memo)

### 3.1 개요

**핵심: View 페이지 없음, List에서 모든 것 처리**

- 본문 전체 표시
- 댓글은 일반 목록 형태 (메신저 UI 아님)
- 새 글 작성은 모달

### 3.2 메모 스킨 UI 레이아웃

```
┌─────────────────────────────────────────────────────────────┐
│  [+ 새 글]  ← 모달로 작성                                    │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  [제목]                                      [작성자] [시간] │
├─────────────────────────────────────────────────────────────┤
│  본문 내용 **전체** 표시                                     │
│  (요약 없음)                                                 │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  댓글 (3개)                                                 │
│  ├─ [유저A] 댓글 내용...                           10분 전  │
│  ├─ [유저B] 댓글 내용...                            5분 전  │
│  └─ [유저A] 댓글 내용...                            방금 전 │
│                                                             │
│  (댓글 N개 초과 시) [더보기]                                 │
├─────────────────────────────────────────────────────────────┤
│  [댓글 입력창...] [등록]                  ← 인라인 입력      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  [제목]                                      [작성자] [시간] │
├─────────────────────────────────────────────────────────────┤
│  본문 내용 전체                                              │
├─────────────────────────────────────────────────────────────┤
│  댓글 없음                                                   │
├─────────────────────────────────────────────────────────────┤
│  [댓글 입력창...] [등록]                                     │
└─────────────────────────────────────────────────────────────┘

... 다음 글 ...
```

### 3.3 메모 스킨 vs 역극 비교

| 구분 | 역극 | 메모 |
|------|------|------|
| 댓글 단위 | 캐릭터 (ch_id) | 회원 (mb_id) |
| 댓글 표시 | 캐릭터별 그룹핑 + 메신저 UI | 일반 목록 (시간순) |
| 댓글 펼침 | 캐릭터별 개별 펼침/접힘 | 전체 표시 + 더보기 |
| 입력 시 | 캐릭터 선택 필요 | 바로 입력 |
| 완결 기능 | O (open/closed) | X |

---

## 4. 기본 제공 게시판 (설치 시)

### 4.1 공지사항 (notice)

| 항목 | 설정 |
|------|------|
| 스킨 | basic (목록형) |
| 글쓰기 | 관리자/스태프만 |
| 댓글 | 비활성화 |
| 비밀글 | 비활성화 |

### 4.2 문의 게시판 (qna)

| 항목 | 설정 |
|------|------|
| 스킨 | memo (메모형) |
| 글쓰기 | 회원 전체 |
| 댓글 | 관리자/스태프만 |
| 비밀글 | 기본 활성화 (작성자+관리자만 열람) |

### 4.3 오너 게시판 (owner)

| 항목 | 설정 |
|------|------|
| 스킨 | memo (메모형) |
| 글쓰기 | 회원 전체 |
| 댓글 | 회원 전체 |
| 비밀글 | 비활성화 |
| 용도 | 유저 간 소통, 자유 게시판 |

### 4.4 앓이란 (vent)

| 항목 | 설정 |
|------|------|
| 스킨 | postit (포스트잇형) |
| 글쓰기 | 회원 전체 |
| 댓글 | 비활성화 |
| 익명 | 기본 활성화 |
| 참고 | lino.it 스타일 |

**앓이란 UI 컨셉**:
```
┌─────────────────────────────────────────────────────────────┐
│  앓이란                                    [+ 포스트잇]      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌────────┐  ┌────────┐  ┌────────┐                       │
│   │ 메모1  │  │ 메모2  │  │ 메모3  │                       │
│   │ 내용.. │  │ 내용.. │  │ 내용.. │                       │
│   │ 익명   │  │ 익명   │  │ 익명   │                       │
│   └────────┘  └────────┘  └────────┘                       │
│                                                             │
│   ┌────────┐  ┌────────┐                                   │
│   │ 메모4  │  │ 메모5  │                                   │
│   │ 내용.. │  │ 내용.. │                                   │
│   │ 익명   │  │ 익명   │                                   │
│   └────────┘  └────────┘                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.5 로그 게시판 (log)

| 항목 | 설정 |
|------|------|
| 스킨 | gallery (갤러리형) |
| 글쓰기 | 회원 전체 |
| 댓글 | 회원 전체 |
| 비밀글 | 비활성화 |
| 이미지 | 없으면 사이트 로고 표시 |
| 용도 | 창작물, 그림, 소설 등 |

---

## 5. 스킨 시스템

### 5.1 스킨 구조

```
/theme/morgan/skin/board/
├── basic/          # 목록형 (기본) - View 페이지 있음
│   ├── list.skin.php
│   ├── view.skin.php
│   ├── write.skin.php
│   └── comment.skin.php
├── gallery/        # 갤러리형 - View 모달 or 페이지
│   ├── list.skin.php
│   ├── view.skin.php
│   └── write.skin.php
├── memo/           # 메모형 - View 없음 (List에서 처리)
│   ├── list.skin.php      # 본문 전체 + 댓글 인라인
│   ├── write.modal.php    # 모달 글쓰기
│   └── comment.skin.php   # 댓글 목록
└── postit/         # 포스트잇형 - 모달
    ├── list.skin.php
    └── write.modal.php

/theme/morgan/skin/rp/     # 역극 전용 - View 없음
├── list.skin.php          # 본문 전체 + 참여자별 이음
├── write.modal.php        # 모달 글쓰기
└── reply.skin.php         # 이음 메신저 UI
```

### 5.2 스킨별 특징

| 스킨 | 목록 | 본문 | 댓글 | 새글 작성 |
|------|------|------|------|-----------|
| basic | 테이블 | 별도 페이지 | 페이지 내 | 별도 페이지 |
| gallery | 카드 그리드 | 모달 or 페이지 | 모달 내 | 별도 페이지 |
| memo | 전체 표시 | 인라인 | 목록형 인라인 | **모달** |
| postit | 그리드 카드 | 모달 | X | **모달** |
| rp | 전체 표시 | 인라인 | 캐릭터별 메신저 | **모달** |

---

## 6. 공통 기능

### 6.1 비밀글

- 작성자 + 관리자만 열람
- 게시판별 활성화/비활성화 설정
- 기본: 비활성화

### 6.2 익명글

- 작성자 닉네임 대신 "익명" 표시
- 관리자는 실제 작성자 확인 가능
- 게시판별 활성화/비활성화 설정
- 기본: 비활성화

### 6.3 이미지 처리

- 썸네일 자동 생성
- 이미지 없는 글: 사이트 로고로 대체 (갤러리형)
- 지원 형식: jpg, png, gif, webp

---

## 7. 관리자 설정

### 7.1 게시판 생성 옵션

| 설정 | 설명 |
|------|------|
| 게시판 ID | 영문 식별자 |
| 게시판명 | 표시 이름 |
| 스킨 선택 | basic/gallery/memo/postit |
| 그룹 | 게시판 그룹 |
| 읽기/쓰기/댓글 권한 | 레벨별 설정 |
| 비밀글 허용 | on/off |
| 익명글 허용 | on/off |
| 파일 첨부 | 개수, 용량 제한 |

### 7.2 역극 설정

| 설정 | 설명 |
|------|------|
| 역극 기능 사용 | on/off |
| 새 글 작성 조건 | 이전 역극 n개 이음 필요 |
| 기본 최대 참여자 | 기본값 |
| 참여자 상한선 | 최대 설정 가능 값 |
| 최소 글자 수 | 내용 최소 길이 |

---

## 8. fetch 기반 비동기 처리

### 8.1 적용 대상

| 기능 | 방식 |
|------|------|
| 목록 페이징 | fetch로 목록만 갱신 |
| 글 보기 (memo/rp) | 인라인 (이미 표시됨) |
| 글 보기 (basic/gallery) | 모달 or fetch 로딩 |
| 댓글 작성/삭제 | fetch 처리 |
| 역극 이음 | fetch 실시간 추가 |
| 좋아요/추천 | fetch 처리 |

### 8.2 API 엔드포인트 (예시)

```
GET  /api/board/{bo_table}/list
GET  /api/board/{bo_table}/view/{wr_id}
POST /api/board/{bo_table}/write
PUT  /api/board/{bo_table}/update/{wr_id}
DELETE /api/board/{bo_table}/delete/{wr_id}

GET  /api/rp/list
POST /api/rp/create
POST /api/rp/{rt_id}/reply
PUT  /api/rp/{rt_id}/close
```

---

## 9. TODO

### 우선 작업
- [ ] memo 스킨 구현 (List + 인라인 댓글)
- [ ] 역극 UI 전면 재작업 (View 삭제, List 통합)
- [ ] postit 스킨 lino.it 참고 설계
- [ ] 모달 글쓰기 컴포넌트
- [ ] fetch API 엔드포인트 구현
- [ ] 게시판 관리 페이지 UI

### 추후 수정
- [ ] **역극 완결 판정 변경**: 역극 전체 → 참여자(메신저) 단위
  - mg_rp_member에 `rm_status` (open/closed) 컬럼 추가
  - 각 참여자별로 완결 버튼/처리
  - 모든 참여자 완결 시 역극 전체 자동 완결

---

*작성일: 2026-02-03*
*수정일: 2026-02-06*
*상태: 2차 기획 수정 (역극/메모 UI 재설계)*
