# 보상 시스템 기획 (Reward System)

> **구현 완료** (Phase 12, 2026-02-08)

> Morgan Edition - 활동 보상 통합 설계
> 관련: POINT.md (포인트 기본), PIONEER.md (재료 시스템), PIONEER_EXPEDITION.md (파견)

---

## 개요

커뮤니티 내 모든 활동에 대해 **포인트 + 재료** 양축 보상을 제공한다.
보상 관리는 **별도 관리자 페이지**에서 통합 관리하며, 게시판별·활동별 세밀한 설정이 가능하다.

---

## 1. 활동별 보상 총괄표

| 활동 | 포인트 | 재료 | 모드 | 비고 |
|------|--------|------|------|------|
| 글 작성 (창작 게시판) | 게시판별 설정 | 드롭 확률 | auto / request | 핵심 보상 |
| 글 작성 (일반 게시판) | 게시판별 설정 | 드롭 확률 | auto | 소량 |
| 글 작성 (메모/오너) | 게시판별 설정 | 드롭 확률 | off (기본) | 설정으로 활성화 가능 |
| 댓글 | 비활성 (기본) | 비활성 | off | 현재 댓글 기능 자체 비활성 |
| 역극 이음 | 10개당 +30 (전원) | 소량 드롭 | auto | 완결 대비 미미한 수준 |
| 역극 완결 | +200 (조건부) | - | auto (모니터링) | 캐릭터별 완결, 상호 이음 조건 |
| 역극 판 개설 | **-500** | - | - | 본전 심리로 완결 유도 |
| 출석체크 | 미니게임 결과 | pioneer_attendance_reward | auto | 연속 출석 2배 (구현 완료) |
| 좋아요 누름 | 소량 | - | auto | 일일 횟수 제한 |
| 좋아요 받음 | 중량 | - | auto | 제한 없음 |
| 첫 로그인 | cf_login_point | - | auto | 그누보드 기본 |
| 상점 구매 | **소모** | - | - | 재화 싱크 |
| 선물 보내기 | **소모** | - | - | 재화 이동 |
| 캐릭터 생성 | **소모** | - | - | 미구현 (예정) |

---

## 2. 게시판별 보상 설정

### 2.1 보상 모드

게시판마다 3가지 모드 중 선택:

| 모드 | 설명 |
|------|------|
| `auto` | 글 작성 즉시 포인트/재료 자동 지급 |
| `request` | 유저가 보상 유형 선택 → 정산 큐 → 스탭 승인 시 지급 |
| `off` | 보상 없음 |

### 2.2 Auto 모드 설정

```
[게시판 보상 설정 - Auto]
├── 기본 포인트: [N] (기존 bo_write_point 대체)
├── 글자수 보너스:
│   ├── [500자 이상] → +[N] 포인트
│   └── [1000자 이상] → +[N] 포인트
├── 이미지 첨부 보너스: +[N] 포인트
├── 재료 드롭:
│   ├── 활성화: [켜기/끄기]
│   ├── 드롭 확률: [N%]
│   └── 드롭 대상: [재료별 체크박스]
└── 일일 보상 횟수 제한: [N회, 0=무제한]
```

### 2.3 Request 모드 설정 (보상 요청)

**유저 측 (글쓰기 폼에 추가)**
```html
<select name="reward_type">
    <option value="">보상 요청 안 함</option>
    <!-- 관리자가 설정한 옵션들 -->
    <option value="1">글만 (500자 이상) - 50P</option>
    <option value="2">글 + 스케치/선화 - 100P</option>
    <option value="3">글 + 채색 일러스트 - 200P</option>
    <option value="4">만화 (3컷 이상) - 300P</option>
</select>
```

**보상 유형 옵션 (관리자 설정)**

| 필드 | 설명 |
|------|------|
| 유형 이름 | "글 + 채색 일러스트" |
| 포인트 보상 | 200 |
| 재료 보상 | JSON: `[{"mt_code":"wood","amount":2}]` (선택) |
| 설명 | 유저에게 보여줄 가이드 텍스트 |
| 정렬 순서 | 드롭다운 순서 |

**정산 페이지 (관리자/스탭)**
- 대기 목록: 작성자, 게시판, 제목(링크), 요청 유형, 작성일
- 일괄 승인 체크박스 + 개별 승인/반려 버튼
- 반려 시 사유 입력 → 작성자에게 알림 발송
- 필터: 게시판별, 유형별, 기간별

### 2.4 DB 스키마 (게시판 보상)

#### mg_board_reward — 게시판별 보상 설정

| 컬럼 | 타입 | 설명 |
|------|------|------|
| br_id | int PK | |
| bo_table | varchar(20) | 게시판 테이블명 |
| br_mode | enum('auto','request','off') | 보상 모드 |
| br_point | int | 기본 포인트 (auto 모드) |
| br_bonus_500 | int | 500자 이상 보너스 |
| br_bonus_1000 | int | 1000자 이상 보너스 |
| br_bonus_image | int | 이미지 첨부 보너스 |
| br_material_use | tinyint | 재료 드롭 사용 여부 |
| br_material_chance | int | 드롭 확률 (0~100) |
| br_material_list | text | 드롭 대상 재료 JSON: `["wood","stone"]` |
| br_daily_limit | int | 일일 보상 횟수 제한 (0=무제한) |

#### mg_reward_type — 보상 요청 유형 (request 모드용)

| 컬럼 | 타입 | 설명 |
|------|------|------|
| rwt_id | int PK | |
| bo_table | varchar(20) | 게시판 (NULL이면 전체 적용) |
| rwt_name | varchar(100) | 유형 이름 |
| rwt_point | int | 포인트 보상 |
| rwt_material | text NULL | 재료 보상 JSON |
| rwt_desc | varchar(255) | 유저 가이드 텍스트 |
| rwt_order | int | 정렬 순서 |
| rwt_use | tinyint | 사용 여부 |

#### mg_reward_queue — 정산 대기열

| 컬럼 | 타입 | 설명 |
|------|------|------|
| rq_id | int PK | |
| mb_id | varchar(20) | 요청 회원 |
| bo_table | varchar(20) | 게시판 |
| wr_id | int | 게시글 ID |
| rwt_id | int | 요청 보상 유형 |
| rq_status | enum('pending','approved','rejected') | 상태 |
| rq_datetime | datetime | 요청일 |
| rq_process_datetime | datetime NULL | 처리일 |
| rq_process_mb_id | varchar(20) NULL | 처리한 스탭 ID |
| rq_reject_reason | varchar(255) NULL | 반려 사유 |

---

## 3. 역극 재화 시스템

### 3.1 핵심 컨셉

판을 세우는 데 재화를 소모시키고, 완결까지 가져가면 리턴을 돌려주는 구조.
**"세우면 끝까지 책임져라"** → 본전 심리로 완결 유도 + 사람을 모아야 이득.

### 3.2 재화 흐름

| 행위 | 포인트 | 비고 |
|------|--------|------|
| 판 세우기 | **-500** | 게시글 작성 시 차감 |
| 잇기 (이음) | 10개당 **+30** | 참여자 전원 대상, 누적 카운트 |
| 캐릭터별 완결 | **+200** | 조건 충족 시에만 |

- 재료: 기존 `pioneer_rp_reward` 유지 (이음 시 확률 기반 소량 드롭)

### 3.3 완결 판정 규칙

**판정 단위:**
- **캐릭터(1차 댓글을 이은 사람) 단위**로 판정
- 판 전체 완결이 아니라, 참여자별로 개별 완결

**보상 조건:**
- 판 세운 사람과 해당 캐릭터 사이에 **상호 n회 이상** 댓글 오감 (총 댓글 2n개 이상)
- n값은 **관리자 설정** (기본값: 5, 즉 총 10개 이상)
- 조건 충족 → 완결 시 **+200 지급**
- 조건 미충족 → confirm 경고 ("보상 없이 완결 처리됩니다") → 보상 0

**완결 처리 주체:**

| 주체 | 방식 |
|------|------|
| 판장 (글 작성자) | 언제든 캐릭터별 완결 버튼으로 임의 처리 가능 |
| 시스템 자동 | **n일 이상** 해당 스레드에 추가 댓글 없으면 자동 완결 |

- 자동 완결 대기일은 **관리자 설정** (기본값: 7일)
- 자동 완결 시에도 보상 조건 충족 여부에 따라 보상 자동 지급 or 보상 없이 종료
- 완결 처리된 캐릭터는 해당 스레드에서 **댓글 잠금** (더 이상 잇기 불가)
- 자동 완결은 cron 또는 접속 시 체크 (패시브 방식)

### 3.4 수익 시뮬레이션

**3인 참여, 전원 완결 (활발한 판):**
```
판 세우기:         -500
잇기 (30댓글):      +90
완결 3건:          +600
────────────────────
순수익:            +190
```

**2인 참여, 둘 다 완결 (보통 판):**
```
판 세우기:         -500
잇기 (20댓글):      +60
완결 2건:          +400
────────────────────
순수익:             -40  (거의 본전)
```

**아무도 안 온 경우:**
```
판 세우기:         -500
7일 후 자동 종료
────────────────────
순수익:            -500  (전액 손실)
```

### 3.5 관리자 설정 항목

| 설정 | 키 | 기본값 | 설명 |
|------|---|--------|------|
| 판 세우기 비용 | `rp_create_cost` | 500 | 역극 게시글 작성 시 차감 |
| 잇기 보상 단위 | `rp_reply_batch_count` | 10 | N개당 보상 지급 |
| 잇기 보상량 | `rp_reply_batch_point` | 30 | 잇기 N개 달성 시 포인트 |
| 완결 보상 | `rp_complete_point` | 200 | 캐릭터별 완결 시 지급 |
| 완결 최소 상호 댓글 | `rp_complete_min_mutual` | 5 | 상호 n회 (총 2n개) |
| 자동 완결 기한 | `rp_auto_complete_days` | 7 | 무활동 시 자동 완결 대기일 |
| 이음 재료 보상 | `pioneer_rp_reward` | 기존 유지 | 확률 기반 소량 드롭 |

### 3.6 완결 모니터링

**관리자 대시보드 위젯: "최근 완결 역극"**
```
[역극 제목] | [완결 캐릭터] | [상호 이음] | [보상] | [완결일] | [방식]
──────────────────────────────────────────────────────────────────
"달빛 아래서" | 레이첼 (user_a) | 12회 ✓ | +200 | 02.10 | 수동
"달빛 아래서" | 다니엘 (user_b) | 3회 ✗  | 0    | 02.10 | 수동
"숲의 끝에서" | 아리아 (user_c) | 8회 ✓  | +200 | 02.09 | 자동(7일)
```

**전용 관리 페이지:**
- 완결 처리된 역극 목록 (기간 필터)
- 캐릭터별 완결 기록 및 누적 보상
- 보상 조건 충족/미충족 표시
- 의심 건 "보류" 처리 → 보상 회수 가능

### 3.7 DB 스키마

#### mg_rp_completion — 역극 완결 기록

| 컬럼 | 타입 | 설명 |
|------|------|------|
| rc_id | int PK AUTO_INCREMENT | |
| rt_id | int | 역극 스레드 ID |
| ch_id | int | 완결 캐릭터 ID |
| mb_id | varchar(20) | 캐릭터 소유자 |
| rc_mutual_count | int | 판장과의 상호 이음 수 |
| rc_total_replies | int | 해당 캐릭터 총 이음 수 |
| rc_rewarded | tinyint | 보상 지급 여부 (조건 충족 시 1) |
| rc_point | int | 지급된 포인트 (0 = 미충족) |
| rc_status | enum('completed','revoked') | 상태 |
| rc_type | enum('manual','auto') | 완결 방식 (수동/자동) |
| rc_datetime | datetime | 완결 처리일 |
| rc_by | varchar(20) NULL | 처리자 (수동: 판장 mb_id, 자동: NULL) |

#### mg_rp_reply_reward_log — 잇기 누적 보상 추적

| 컬럼 | 타입 | 설명 |
|------|------|------|
| rrl_id | int PK AUTO_INCREMENT | |
| rt_id | int | 스레드 ID |
| rrl_reply_count | int | 보상 지급 시점 누적 이음 수 |
| rrl_point | int | 지급 포인트 |
| rrl_datetime | datetime | |

> 10이음당 보상은 스레드 전체 이음 수 기준. 참여자 전원에게 지급.
> 예: 10이음 도달 시 참여자 3명 → 3명 각각 +30P.

### 3.8 설계 의도

- **500 소모**: 남발 방지 + 책임감 부여. "비싸서 못 세운다"가 아니라 "세우면 끝까지 해라"
- **사람 모아야 이득**: 혼자로는 본전 불가 → 자연스러운 모집 활동 → 커뮤니티 활성화
- **자동 완결**: 잠수/탈퇴 대응. 별도 요청 플로우 없이 시간이 해결
- **캐릭터별 판정**: 참여자마다 독립적으로 완결 가능. "내 분량은 여기서 마무리" 허용
- **상호 이음 조건**: 일방적 독백 방지. 실제로 "역극"이 이루어진 경우에만 보상
- **VN Engine 연동**: 완결된 역극 → 비주얼 노벨 자동 변환 소재로 활용 가능 (향후)

---

## 4. 좋아요 재화 연동

### 4.1 컨셉

기존 그누보드 좋아요(추천)에 **일일 횟수 제한 + 양방향 보상**을 부여.
"좋아요"가 한정된 자원을 배분하는 행위가 되어, 커뮤니티 활동 자체가 파밍이 되는 구조.

### 4.2 보상 구조

| 행위 | 보상 대상 | 포인트 | 비고 |
|------|----------|--------|------|
| 좋아요 누름 | 누른 사람 | 10P (설정 가능) | 일일 제한 내 |
| 좋아요 받음 | 받은 사람 | 30P (설정 가능) | 제한 없음 |

### 4.3 제한 규칙

| 규칙 | 값 | 설정 키 |
|------|---|---------|
| 일일 좋아요 횟수 | 5회 (기본) | `like_daily_limit` |
| 동일 대상 제한 | 같은 사람에게 1일 1회 | 기본 적용 |
| 동일 게시글 제한 | 같은 글에 1회 | 기존 그누보드 |
| 자기 글 좋아요 | 불가 | 기존 그누보드 |
| 누른 사람 보상 | 10P | `like_giver_point` |
| 받은 사람 보상 | 30P | `like_receiver_point` |
| 리셋 시점 | 자정 (패시브) | - |

### 4.4 시뮬레이션

**누르는 사람 (5회 기준):** 5 × 10 = 일일 50P
**인기글 작성자 (10좋아요):** 10 × 30 = 일일 300P
**최소 활동 유저:** 좋아요 5번만 눌러도 50P 확보

### 4.5 어뷰징 대응

| 시나리오 | 대응 |
|---------|------|
| 상호 좋아요 교환 | 동일 대상 1일 1회 제한 (최대 40P/일) |
| 의미 없는 글에 좋아요 | 스탭 모니터링으로 대응 |
| 부계정 자작 좋아요 | IP 체크 (선택적), 운영 이슈 |

### 4.6 게시글 UI 변경

```
기존: 👍 추천 (3)
변경: ❤ 좋아요 (7) │ +30P │ 남은 횟수: 2/5
      "좋아요를 누르면 나에게 10P, 작성자에게 30P"
```

- 횟수 소진 시: 버튼 비활성 + "내일 다시 보낼 수 있어요"
- 이미 누른 글: ❤ 채워진 상태 + "이미 응원했어요"
- 특정 게시판 좋아요 보상 OFF 가능 (공지판 등)

### 4.7 DB 스키마

#### mg_like_log — 좋아요 재화 로그

| 컬럼 | 타입 | 설명 |
|------|------|------|
| ll_id | int PK | |
| mb_id | varchar(20) | 좋아요 누른 회원 |
| target_mb_id | varchar(20) | 좋아요 받은 회원 |
| bo_table | varchar(20) | 게시판 |
| wr_id | int | 게시글 ID |
| ll_giver_point | int | 누른 사람 보상 |
| ll_receiver_point | int | 받은 사람 보상 |
| ll_datetime | datetime | |

#### mg_like_daily — 일일 좋아요 카운터

| 컬럼 | 타입 | 설명 |
|------|------|------|
| ld_id | int PK | |
| mb_id | varchar(20) | |
| ld_date | date | |
| ld_count | int | 오늘 사용 횟수 |
| ld_targets | text | 오늘 좋아요 준 대상 JSON |

---

## 5. 보상 관리 페이지 (관리자)

### 5.1 페이지 구조

```
보상 관리 (adm/morgan/reward.php)
├── [탭] 게시판별 보상
│   ├── 게시판 목록 테이블
│   ├── 각 행: 게시판명, 모드(auto/request/off), 기본 포인트, 재료 드롭, 편집 버튼
│   └── 편집 모달: 전체 보상 설정 UI
├── [탭] 보상 유형 관리 (request 모드용)
│   ├── 유형 목록 (이름, 포인트, 재료, 게시판)
│   └── 추가/수정/삭제
├── [탭] 정산 대기열
│   ├── pending 목록 (필터: 게시판, 기간)
│   ├── 일괄 승인 / 개별 승인·반려
│   └── 처리 완료 이력
├── [탭] 역극 보상
│   ├── 이음/완결 보상 설정
│   ├── 완결 기록 목록 (모니터링)
│   └── 보상 회수 기능
├── [탭] 좋아요 보상
│   ├── 일일 횟수, 보상량 설정
│   ├── 게시판별 ON/OFF
│   └── 좋아요 로그 (어뷰징 모니터링)
└── [탭] 활동 보상 설정
    ├── 출석 보상 (→ 기존 출석 설정 링크)
    ├── 로그인 보상
    └── 재료 드롭 전역 설정 (pioneer 연동)
```

### 5.2 사이드바 메뉴

```
보상 관리
├── 보상 설정 (게시판별 + 활동별)
├── 정산 대기열 (pending 건수 뱃지)
├── 역극 완결 기록
└── 좋아요 로그
```

---

## 6. 구현 우선순위

```
[1단계] 게시판별 보상 설정 + Auto 모드
├── mg_board_reward 테이블
├── 보상 관리 페이지 (게시판 탭)
├── write_update.php 훅 수정 (글자수 보너스, 이미지 보너스, 재료 드롭)
└── 기존 bo_write_point와 병행 또는 대체

[2단계] 역극 재화 시스템
├── mg_rp_completion, mg_rp_reply_reward_log 테이블
├── 판 개설 비용 차감 (rp_write.php)
├── 잇기 누적 보상 (10개당 전원 +30P)
├── 캐릭터별 완결 UI (list.skin.php) + 상호 이음 조건 체크
├── 자동 완결 로직 (패시브 체크)
├── 완결 시 조건부 보상 지급
└── 관리자 모니터링 페이지 + 대시보드 위젯

[3단계] 좋아요 재화 연동
├── mg_like_log, mg_like_daily 테이블
├── good.php 수정 (보상 지급 + 일일 제한)
├── 게시글 뷰 스킨 수정 (남은 횟수 표시)
└── 관리자 설정 + 로그 페이지

[4단계] Request 모드 (보상 요청 + 정산)
├── mg_reward_type, mg_reward_queue 테이블
├── 글쓰기 폼에 보상 유형 select 추가
├── 정산 대기열 관리 페이지
└── 승인/반려 처리 + 알림

[5단계] 대시보드 통합
├── 역극 완결 위젯
├── 정산 대기 위젯
└── 보상 통계 요약
```

---

## 7. 기존 시스템과의 관계

| 기존 | 변경 |
|------|------|
| `bo_write_point` (그누보드) | auto 모드에서 `br_point`로 대체 (또는 병행) |
| `bo_comment_point` | 현재 비활성, 향후 필요 시 동일 구조 적용 |
| `pioneer_write_reward` (전역) | 게시판별 `br_material_*`로 세분화 |
| `pioneer_rp_reward` (전역) | 유지 + 완결 보상 추가 |
| `insert_point()` (그누보드) | 그대로 사용 (보상 지급 수단) |
| `mg_reward_material()` | 그대로 사용 (재료 지급 수단) |

---

*작성일: 2026-02-10*
*상태: 기획 완료, 구현 대기*
*관련: POINT.md, PIONEER.md, PIONEER_EXPEDITION.md*
