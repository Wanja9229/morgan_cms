# 개척 확장: 탐색 파견 시스템 (Expedition)

> Morgan Edition - 개척 시스템 확장 모듈
> 기존 문서: PIONEER.md (Phase 8)의 확장
> 관련: REWARD.md (좋아요 재화 연동은 보상 시스템으로 이관)

---

## 기획 의도

기존 개척 시스템의 핵심 루프(접속 → 스태미나 → 건물 투입)에 **선택지**를 추가한다.
유저는 매일 받는 스태미나를 건물 건설에 직접 투입할지, 탐색 파견을 보내 재료를 수급할지 **자원 배분 의사결정**을 해야 한다.

---

## 1. 컨셉

- 모바일 게임의 파견/원정 시스템을 웹 커뮤니티에 맞게 경량화
- 레퍼런스: 원신 탐사 파견, 명일방주 보안 파견, 블루 아카이브 총력전 파견
- **유저 액션 최소화**: 캐릭터 선택 → 파견지 선택 → 보내기 → 시간 후 수령
- 파견 중에도 커뮤니티 활동(글쓰기, 역극 등)은 정상적으로 가능

---

## 2. 핵심 구조

```
[파견 페이지 접속]
    ↓
내 캐릭터 선택 (메인 1명)
    ↓
파트너 선택 (회원 목록에서 1명)
    ↓
파견지 선택 (관리자가 등록한 지역 목록)
    ↓
스태미나 소모 → 파견 시작 (타이머 시작)
    ↓
소요시간 경과 후 → "수령" 버튼 활성화
    ↓
확률 기반 보상 획득 (재료 중심 + 소량 포인트)
```

---

## 3. 파견 규칙

| 항목 | 설정 | 설정 키 |
|------|------|---------|
| 동시 파견 수 | 기본 1회, 시설 해금으로 확장 (최대 3) | `expedition_max_slots` |
| 스태미나 소모 | 파견지마다 다름 (기본 2~6) | 파견지별 설정 |
| 소요 시간 | 파견지마다 다름 (1~8시간) | 파견지별 설정 |
| 보상 | 확률 기반 드롭 테이블 (재료 중심) | 파견지별 드롭 테이블 |
| 파트너 보상 | 파트너에게 소량 포인트 (5~10P) | `expedition_partner_point` |
| 파견 취소 | 가능하나 스태미나 반환 없음 | - |

---

## 4. 파견지 예시 (관리자 등록)

| 파견지 | 소요시간 | 스태미나 | 주요 드롭 | 레어 드롭 |
|--------|---------|---------|----------|----------|
| 숲 외곽 | 1시간 | 2 | 목재 1~2 | - |
| 폐광산 | 2시간 | 3 | 석재 1~2, 철광석 0~1 | 마법석 (5%) |
| 고대 도서관 | 4시간 | 4 | 책 1~3 | 희귀 서적 (10%) |
| 수정 동굴 | 6시간 | 5 | 마법석 1~2 | 유리 1~2 (20%) |
| 미지의 영역 | 8시간 | 6 | 랜덤 재료 2~4 | 레어 재료 묶음 (8%) |

> 파견지 목록, 소요시간, 보상, 드롭 확률은 관리자가 자유롭게 설정 가능.

---

## 5. 파트너 시스템

- 파견 시 회원 목록에서 1명을 파트너로 선택
- **동의 없이** 자동 선택됨 (부담 없는 구조)
- 파견 완료 시 파트너에게 알림 + 소량 보상 (포인트)
- 동일인 파트너 선택 **1일 1회 제한** (분산 유도)
- "오늘 나를 파트너로 선택한 사람" 목록 조회 가능

---

## 6. 자원 배분 딜레마

```
스태미나 10 (일일 기본)
    ├── 건물에 직접 투입: 즉시 기여, 랭킹 반영
    ├── 탐색 파견: 시간 후 재료 획득, 확률 기반
    └── 혼합: 5를 건물에, 5로 파견 2회
```

**핵심**: 건물을 빨리 짓고 싶으면 직접 투입, 재료가 부족하면 파견.
커뮤니티 단위로 "이번 주는 다 건물에 박자" vs "재료 먼저 모으자" 같은 토론 유도.

---

## 7. DB 스키마

### mg_expedition_area — 파견지 정의

| 컬럼 | 타입 | 설명 |
|------|------|------|
| ea_id | int PK AUTO_INCREMENT | 파견지 ID |
| ea_name | varchar(100) | 파견지 이름 |
| ea_desc | text | 설명 |
| ea_icon | varchar(200) | 아이콘 (heroicons명 또는 이미지 경로) |
| ea_image | varchar(500) | 배경 이미지 |
| ea_stamina_cost | int | 필요 스태미나 |
| ea_duration | int | 소요 시간 (분) |
| ea_status | enum('active','hidden','locked') | 상태 |
| ea_unlock_facility | int NULL | 필요 시설 ID (해금 조건) |
| ea_partner_point | int | 파트너 보상 포인트 (기본 10) |
| ea_order | int | 정렬 순서 |

### mg_expedition_drop — 파견지별 드롭 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| ed_id | int PK AUTO_INCREMENT | |
| ea_id | int | 파견지 ID |
| mt_id | int | 재료 종류 (mg_material_type) |
| ed_min | int | 최소 획득량 |
| ed_max | int | 최대 획득량 |
| ed_chance | int | 드롭 확률 (0~100) |
| ed_is_rare | tinyint | 레어 드롭 여부 (UI 강조용) |

### mg_expedition_log — 파견 기록

| 컬럼 | 타입 | 설명 |
|------|------|------|
| el_id | int PK AUTO_INCREMENT | |
| mb_id | varchar(20) | 파견 보낸 회원 |
| ch_id | int | 선택한 캐릭터 ID |
| partner_mb_id | varchar(20) | 파트너 회원 ID |
| ea_id | int | 파견지 ID |
| el_stamina_used | int | 소모 스태미나 |
| el_start | datetime | 파견 시작 시각 |
| el_end | datetime | 파견 완료 예정 시각 |
| el_status | enum('active','complete','claimed','cancelled') | 상태 |
| el_rewards | text NULL | 획득 보상 JSON (수령 후 기록) |

---

## 8. 프론트 UI

### 8.1 디자인 원칙

- Morgan 테마 다크 기반 (`--mg-bg-*`, `--mg-text-*` 변수 활용)
- Tailwind 유틸리티 + 기존 `.mg-card`, `.mg-badge` 컴포넌트 재사용
- 모바일 우선 (자캐 커뮤 유저 대부분 모바일), 터치 타겟 최소 44px
- 과도한 애니메이션 자제 (웹 기반 경량화)

### 8.2 색상 체계

| 요소 | 색상 | 비고 |
|------|------|------|
| 스태미나 | `--mg-accent` | 기존 포인트 컬러 |
| 재료 | `--mg-success` | 녹색 계열 |
| 포인트(골드) | `text-yellow-400` | 재화 표시 |
| 레어 드롭 | `text-purple-400` + glow | 강조 연출 |
| 잠긴 항목 | `opacity-50` + 자물쇠 | 해금 조건 안내 |

### 8.3 파견 페이지 구조

```
파견 페이지 (bbs/expedition.php)
├── 상단: 현재 스태미나 표시
├── 진행 중인 파견 카드 (타이머 + 진행률 바)
│   └── 완료 시 "수령하기" 버튼 활성화
├── 파견 보내기
│   ├── STEP 1: 캐릭터 선택
│   ├── STEP 2: 파트너 선택
│   └── STEP 3: 파견지 선택 (카드 목록, 잠긴 것 포함)
└── 하단: 최근 파견 이력
```

### 8.4 수령 화면

```
[파견 완료!]
├── 드롭 결과 카드 (재료 아이콘 + 수량)
│   └── 레어 아이템: ★RARE 뱃지 + 보라색 강조
├── 파트너 보상 안내
└── [수령하기] [재파견] 버튼
```

---

## 9. 관리자 기능

| 기능 | 페이지 |
|------|--------|
| 파견지 등록/수정/삭제 | adm/morgan/expedition_area.php |
| 파견지별 드롭 테이블 설정 | 파견지 편집 내 |
| 해금 조건 설정 (시설 연동) | 파견지 편집 내 |
| 동시 파견 슬롯 수 설정 | 개척 설정 내 |
| 파견 로그 조회 | adm/morgan/expedition_log.php |

---

## 10. 개척 메인 페이지 통합

파견 시스템 추가 후 개척 메인 페이지(`bbs/pioneer.php`) 리디자인:

```
개척 현황 페이지
├── 탭: [시설 건설] [탐색 파견] [기여 랭킹]
├── 상단: 스태미나 바 + 보유 재료 요약
├── 시설 탭: 기존 시설 카드 그리드
├── 파견 탭: 진행 중 파견 + 파견 보내기
└── 랭킹 탭: 시설별 기여 순위
```

---

## 11. 구현 우선순위

개척 확장은 기본 시스템 안정화 후 진행:

```
[선행] 보상 시스템 기본 (REWARD.md) 완료
[선행] 좋아요 재화 연동 (REWARD.md §4) 완료
    ↓
[파견 1단계] 파견지 관리 + 드롭 테이블 (관리자)
[파견 2단계] 파견 보내기/수령 로직
[파견 3단계] 파트너 시스템 + 알림
[파견 4단계] 개척 메인 페이지 리디자인
```

---

*작성일: 2026-02-10*
*원본: PIONEER_EXPANSION.md에서 파견 부분 분리*
*상태: 기획 완료, 구현 대기 (후순위)*
