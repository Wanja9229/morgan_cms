# SS Engine (Session System Engine) — 기획서

> 작성일: 2026-02-12
> 최종 수정: 2026-02-13
> 상태: 핵심 기획 완료, 밸런싱 미정
> 연동 대상: Morgan CMS (그누보드5 기반)
> 실시간 처리: Supabase Realtime
> 전투 로직: PHP

---

## 1. 프로젝트 개요

### 목표
- 자캐커뮤/창작 커뮤니티를 위한 웹 기반 세미 턴제 전투 플랫폼
- 비개발자도 쉽게 사용할 수 있는 구성
- 캐릭터 서사 + 전투 + 창작 기반 성장 요소의 결합
- MMORPG식 전투 구조를 TRPG 감성으로 단순화 및 커뮤니티화

### 핵심 철학
- **"창작이 게임이 되고, 게임이 다시 창작 소재가 되는"** 순환 구조
- 전투는 소모이자 서사 컨텐츠, 이벤트 — 별도의 게임이 아닌 커뮤니티 컨텐츠의 일부
- 성장은 오직 창작활동 기반

### 기술 구조
- **로직**: PHP (Morgan CMS 위에서 동작)
- **실시간**: Supabase Realtime (전투 상태 동기화, 주시 표시 등)
- **데이터**: Morgan CMS의 기존 포인트/재료/상점/캐릭터 시스템과 연동

---

## 1.5 사전 작업 (1차 M7에서 이관)

> 기존 ROADMAP M7 "캐릭터 장비"가 SS Engine과 완전히 겹치므로 여기서 통합 진행.

- [ ] DB 테이블 설계 (mg_character_equip — 무기+방어구 2슬롯, 캐릭터별)
- [ ] 캐릭터별 장비 적용 로직 (인벤토리 → 장착/해제)
- [ ] 캐릭터 프로필에 장비 표시
- [ ] 상점 equip 타입 아이템과 연동 (기존 si_type='equip' 활용)

---

## 2. 스탯 시스템

### 기본 스탯 (4개)

| 스탯 | 영향 |
|------|------|
| **체력** | HP 수치, 탱커 스킬 효과량 (쉴드량, 피해 분담 비율 등) |
| **근력** | 근력 계열 장비의 공격력 보정 |
| **마력** | 마법 계열 장비의 공격력 보정, 힐량 보정 |
| **숙련** | 크리티컬 확률, 회피 확률, 근력 딜러 보조 보정 |

### 장비 기반 수치

| 수치 | 출처 | 설명 |
|------|------|------|
| **공격력** | 무기 기초 공격력 + 장비 보정 스탯에 의한 보정 | 실제 데미지의 베이스 |
| **방어력** | 방어구 기초 방어력 | 데미지 경감 |

- 스탯은 보정 역할, 장비가 실제 공격력/방어력을 담당
- 장비마다 지정된 보정 스탯이 있음 (탱커 무기 → 체력 보정, 스킬딜러 무기 → 마력 보정 등)

### 성장 방식
- **경험치 시스템 없음**
- 모든 성장은 **재화(포인트)로 스탯 구매**
- 포인트는 창작활동으로 획득
- 전투 참여 시 소량의 포인트 지급

> **[추후 논의 필요] 시간표(수업) 시스템**
> 단순 스탯 직접 구매 대신, "시간표" 개념 도입 검토 중.
> 포인트를 써서 학업/훈련/수련 등의 수업을 등록하면 특정 스탯이 오르는 방식.
> RP 맥락에서 "캐릭터가 훈련을 받아 성장한다"는 서사를 자연스럽게 부여.
> 구체적 설계는 SS Engine 구현 시 별도 논의.

---

## 3. 역할 및 빌드

### 3.1 탱커

**공통 특성**: 도발 스킬로 어그로를 관리하여 파티를 보호. 탱커 무기군은 공격 행동에 어그로 보정이 붙음.

#### 체력 탱커 (안정형)
- 체력↑ + 방어 장비
- HP와 장비 방어력으로 버팀
- 아군 피해 흡수, 전체 쉴드로 팀을 직접 보호
- **플레이 감각**: 맞고 버티면서 패턴을 받아내는 안정감

#### 회피 탱커 (위기관리형)
- 숙련↑ + 가벼운 장비
- 회피 확률로 버팀
- 어그로 조작 스킬이 많음 (전가, 리셋, 1턴 무적)
- 기본 공격 딜도 체력탱보다 나음
- **플레이 감각**: 위기를 기술로 넘기는 트릭스터

### 3.2 딜러

#### 근력 딜러 (평타형)
- 근력↑ + 숙련 보조
- 쿨타임 짧은 딜링기 + 자가 버프 위주
- 꾸준하고 안정적인 딜
- **플레이 감각**: 버프 깔고 루틴 돌리면서 어그로 눈치보기

#### 스킬 딜러 (마법형)
- 마력↑
- 긴 쿨타임의 고위력 스킬, 차징(지연 턴) 스킬
- 한 방이 크지만 빈 턴이 있음
- **플레이 감각**: 쿨타임 관리하며 큰 한방 타이밍 잡기

### 3.3 힐러

#### 정석 힐러 (즉발형)
- 마력↑ + 힐량 보정 장비
- 즉발 체력 회복, 쉴드, 전체 치유
- 즉발 디버프 해제 (클렌즈)
- **플레이 감각**: 급한 상황에 바로 대응, 대신 어그로 부담 큼

#### 비정형 힐러 (서포터형)
- 마력↑ + 힐량 보정 장비
- 도트 힐, 버프, 디버프, 사전 예방형 디버프 내성
- **플레이 감각**: 미리 깔아두는 예측 플레이, 어그로 부담 적음

**힐러 차별점 정리**:

| 항목 | 정석 힐러 | 비정형 힐러 |
|------|----------|------------|
| 힐 방식 | 즉발 회복 | 도트 힐 |
| 위기 대응 | 강함 | 약함 |
| 어그로 부담 | 큼 | 적음 |
| 디버프 대응 | 즉발 해제 (사후 대응) | 디버프 내성 부여 (사전 예방) |
| 추가 역할 | 쉴드 | 버프/디버프 |

---

## 4. 턴 구조

### 기본 흐름
```
유저 턴 (3분 제한)
├── 4명 각자 행동 선택 (기본 공격 / 방어 / 스킬 / 아이템)
├── 3분 이내에 모든 유저가 입력 완료
├── 입력한 순서대로 행동 처리
└── (행동 순서에 스탯 판정 없음)

    ↓

몬스터 턴
├── 어그로 기반 타겟 결정
├── 패턴에 따른 행동 실행
└── 상태 업데이트 (주시 표시 등)

    ↓

턴 전환
├── 어그로 일정량 자연 감소
└── 다음 유저 턴 시작
```

### 행동 선택지

| 행동 | 설명 |
|------|------|
| **기본 공격** | 장비 공격력 + 보정 스탯 + 100다이스 판정. 스킬 쿨타임 중 기본 행동 |
| **방어** | 해당 턴 피해 감소. 위기 상황에서의 보험 선택지 |
| **스킬** | 슬롯에 장착한 스킬 사용. 쿨타임 관리 필요 |
| **아이템** | 소모품 사용 |

---

## 5. 판정 시스템

### 100다이스 기반

- 100면 주사위를 굴려 기본값 산출
- **스탯이 베이스, 주사위는 흔드는 역할** (스탯 차이를 뒤집을 정도는 아님)
- 주사위 결과에 따른 판정 구간:

| 구간 | 효과 |
|------|------|
| **대실패** | 공격 빗나감 / 효과 실패 / 역효과 |
| **실패** | 약화된 데미지/효과 (부분 성공) |
| **성공** | 표준 데미지/효과 |
| **대성공** | 크리티컬 — 대폭 강화된 데미지/효과 |

### 데미지 공식 (방향)
```
기본 공격 시:
1. 장비 기초 공격력 산출
2. 보정 스탯에 의한 공격력 보정 적용
3. 100다이스 굴림 → 판정 구간 결정
4. 판정 구간에 따른 배율 적용
5. 대상 방어력(장비) 차감
6. 최종 데미지 확정
```

- 구체적인 수치/계수는 밸런싱 단계에서 조정

---

## 6. 어그로 시스템

### 핵심 개념
- 모든 행동에 어그로 수치가 누적됨
- 임계치(예: 80/100) 초과 시 몬스터가 해당 유저를 **"주시"**
- **유저 턴으로 넘어올 때 어그로 일정량 자연 감소** (감소식)

### 어그로 발생 기준

| 행동 | 어그로 발생량 |
|------|-------------|
| 딜링 | 딜량 비례 (많이 때릴수록 위험) |
| 힐링 | 힐량 비례 (많이 힐할수록 위험) |
| 탱커 도발 | 고정 대량 획득 |
| 버프/디버프 | 소량 |
| 탱커 무기 기본 공격 | 무기 어그로 보정으로 소량 추가 |

### 주시 시스템

| 조건 | 동작 |
|------|------|
| 어그로 80 미만 | 어그로 보정을 받는 랜덤 타겟 |
| 어그로 80 이상 (1명) | 해당 유저 주시 → 우선 공격 |
| 어그로 80 이상 (복수) | 80 이상인 유저들 사이에서 **어그로 비례 확률**로 타겟 결정 |

### 주시 표시
- 주시 예고 없음 (즉시 반영)
- 주시 대상의 카드/아이콘에 시각적 표시
- 어그로가 튀면 몬스터 턴 시작 시 주시자 변경 → 대응이 어려움 (의도된 긴장감)

### 설계 원칙
> "탱커가 도발 없이 일반 행동만 해도 80 근처를 유지할 수 있되, 딜러가 크리티컬 터뜨리면 위협받는 수준"

- 탱커: 80 이상을 유지해야 함 → 도발 + 무기 어그로 보정으로 관리
- 딜러: 어그로가 80에 튀지 않도록 딜량 조절 필요
- 힐러: 어그로를 끌지 않는 선에서 HP 관리

---

## 7. 스킬 시스템

### 공통 구조

**자원 소모 없음 (MP 없음), 쿨타임만으로 제한**

스킬 1개의 구성요소:

| 속성 | 설명 |
|------|------|
| 이름 | 표시용 |
| 타입 | 공격 / 방어 / 힐 / 버프 / 디버프 / 어그로 조작 |
| 대상 | 자신 / 아군 1명 / 아군 전체 / 적 1명 / 적 전체 |
| 기반 스탯 | 근력 / 마력 / 체력 / 숙련 |
| 계수 | 기반 스탯의 반영 비율 (위력 조절) |
| 쿨타임 | 사용 후 n턴 뒤 재사용 가능 (0 = 매턴 가능) |
| 어그로 값 | 사용 시 어그로 증가량 |
| 추가 효과 | 도트 데미지, 도트 힐, 상태이상, 쉴드, 차징 등 |

### 차징(지연 턴) 시스템
- 강력한 스킬은 사용 시 즉발되지 않고, 다음 턴에 발동
- 차징 턴에는 행동 불가 (또는 기본 공격만 가능)
- 밸런스 장치: 큰 한방을 주는 대신 1턴의 리스크

### 스킬 슬롯
- 기본: **3슬롯**
- 연구 시스템 완료 시: **+1슬롯** (최대 4)
- 상점 고가 아이템 구매 시: **+1슬롯** (최대 5)

### 스킬 획득 방식
- 역할별 **기본 제공 스킬 세트** (CMS 기본 제공, 4~6개)
- 유저가 그 중 슬롯 수만큼 선택하여 장착
- **추가 스킬은 상점에서 포인트로 구매**
- 운영자가 커스텀 스킬을 만들어 상점에 등록 가능 (향후)
- 시즌/이벤트에 따라 스킬 라인업 확장

### 역할별 기본 스킬 세트

#### 체력 탱커

| 스킬 | 쿨타임 | 설명 |
|------|--------|------|
| 도발 | 1 | 어그로 대량 획득. 탱커의 핵심 |
| 피해 분담 | 3 | 아군 전체 피해의 n%를 자신이 대신 받음. 체력 기반 비율 결정 |
| 전체 쉴드 | 5~7 | 아군 전체에 체력 기반 쉴드 부여. 전략 스킬 |

#### 회피 탱커

| 스킬 | 쿨타임 | 설명 |
|------|--------|------|
| 도발 | 1 | 체력탱과 공통 |
| 어그로 전가 | 3 | 자신의 어그로 대폭 감소 + 지정 아군 1명 어그로 소량 감소 |
| 긴급 회피 | 8~10 | 1턴 피해 무효화. 한 전투 1회 보험 |

#### 근력 딜러

| 스킬 | 쿨타임 | 설명 |
|------|--------|------|
| 강타 | 1 | 근력 기반 단일 공격. 기본 공격보다 강하지만 어그로도 높음 |
| 전투 집중 | 4 | 자가 버프. n턴간 딜 증가. 숙련 기반 효과량 |
| 급소 찌르기 | 3 | 숙련 기반 단일 공격. 크리티컬 확률 대폭 상승. 어그로 리스크 |

#### 스킬 딜러

| 스킬 | 쿨타임 | 설명 |
|------|--------|------|
| 마법탄 | 1 | 마력 기반 단일 공격. 기본 딜링기 |
| 집속 마법 | 5 (차징 1턴) | 마력 기반 고위력 단일 공격. 다음 턴 발동 |
| 마력 폭발 | 7~8 | 마력 기반 전체 공격. 어그로 대량 발생 |

#### 정석 힐러

| 스킬 | 쿨타임 | 설명 |
|------|--------|------|
| 치유 | 1 | 마력 기반 단일 즉발 힐 |
| 보호막 | 3 | 아군 1명에게 쉴드 부여 |
| 전체 치유 | 6~7 | 아군 전체 소량 회복. 어그로 대량 |
| 클렌즈 | 2~3 | 아군 1명 디버프 즉시 해제 |

#### 비정형 힐러

| 스킬 | 쿨타임 | 설명 |
|------|--------|------|
| 재생 | 2 | 아군 1명에게 n턴 도트 힐. 어그로 부여 시점에만 소량 발생 |
| 약화 | 3 | 몬스터에게 n턴 공격력 감소 디버프 |
| 활력 부여 | 4~5 | 아군 1명에게 n턴 공격력 버프 |
| 디버프 내성 | 3~4 | 아군 1명에게 n턴간 디버프 면역 부여 (사전 예방형) |

> 각 역할 4개 스킬 중 기본 3슬롯에 맞춰 선택. 전투 상황에 따라 조합 변경.
> 추가 스킬은 상점에서 구매하여 선택지 확장.

---

## 8. 장비 시스템

### 장비 슬롯: 2개
- **무기**: 기초 공격력 + 보정 스탯 + 역할별 추가 보정
- **방어구**: 기초 방어력

### 장비 특성

| 역할 | 무기 보정 스탯 | 무기 추가 효과 | 방어구 특성 |
|------|--------------|---------------|------------|
| 탱커 | 체력 | 공격 행동 시 어그로 보정 | 높은 방어력 |
| 근력 딜러 | 근력 (+숙련) | 높은 기초 공격력 | 중간 방어력 |
| 스킬 딜러 | 마력 | 스킬 데미지 보정 | 낮은 방어력 |
| 힐러 | 마력 | 힐량 보정 | 낮은~중간 방어력 |

### 장비 규칙
- **등급 없음** — 가격과 요구 스탯으로 차등
- **강화 없음**
- **장비 카테고리로 역할 구분** (탱커용/딜러용/힐러용)
- 요구 스탯을 두어 컨셉 특화 유도

### 장비 획득 경로
- **상점**: 포인트로 구매
- **전투 드랍**: 특정 보스/몬스터에서 획득
- **이벤트 보상**: 운영자가 지급
- **관리자 커스텀**: 유일템 등 특수 장비 직접 등록 가능

### 확장 여지
- 악세서리 슬롯 추후 추가 가능

---

## 9. 몬스터 시스템

### 몬스터 스탯 (3개)

| 스탯 | 설명 |
|------|------|
| **HP** | 몬스터 체력 |
| **공격력** | 유저에게 가하는 데미지 베이스 |
| **방어력** | 유저 딜을 경감하는 수치 |

- 속성 상성 없음 (단순하게)

### 몬스터 행동 풀

| 행동 | 설명 |
|------|------|
| 단일 공격 | 주시 대상 1명 공격 |
| 전체 공격 | 파티 전원 공격 |
| 자기 버프 | 광폭화 등 (공격력 증가, 방어력 증가 등) |
| 디버프 | 특정 유저에게 약화 (방어력 감소, 공격력 감소 등) |
| 특수 패턴 | 체력 1로 만들기, 어그로 초기화/역전, 자가 HP 회복 |

### 패턴 구조

#### 기본: 랜덤 패턴
- 운영자가 행동 풀에서 사용할 행동을 등록
- 매 턴 등록된 행동 중 랜덤 선택

#### HP 조건 분기
- 특정 HP % 진입 시 이벤트 발동
- **연출**: 운영자가 입력한 대사 출력 → "○○○가 ×××를 준비합니다" 예고
- **다음 턴에 발동** → 유저에게 대응 시간 1턴 부여
- 예: HP 50% → 광폭화 + 대사, HP 30% → 전체 공격 예고

#### 고급: 턴별 스크립트 (향후)
- 운영자가 턴별 시나리오를 직접 작성
- "1턴 단일공격, 2턴 전체공격, 3턴 힐러 디버프..." 식의 시나리오
- 레이드급 컨텐츠용

---

## 10. 보상 구조

### 전투 보상
- **재료 드랍**: 개척에 필요한 재료 (특정 보스에게서만 드랍하는 재료 포함)
- **소량의 포인트**: 전투 참여 보상

### 경제 순환

```
창작활동 → 포인트 획득
                ↓
        상점에서 스탯/스킬/장비/재료 구매
                ↓
        전투 준비 완료
                ↓
        전투 → 재료 드랍 + 소량 포인트 + 전투 로그(서사)
                ↓
        재료를 개척에 투입 → 새 영역 해금
                ↓
        새 컨텐츠/창작 소재 → 다시 창작활동
```

### 핵심 원칙
- **성장(스탯/스킬)은 창작활동 기반** — 전투만으로는 강해지지 않음
- **전투는 개척을 위한 수단** — 전투 자체가 목적이 아님
- **특정 재료의 보스 전용 드랍**으로 전투 동기 형성

---

## 11. 전투 흐름 시뮬레이션 (예시)

### 세팅
- A: 체력 탱커, B: 근력 딜러, C: 스킬 딜러, D: 정석 힐러
- 몬스터: 보스급 (HP 50% 광폭화, HP 30% 전체 공격 예고)

### 턴 1 — 전투 시작
- A: 도발 → 어그로 80 돌파, 주시 확보
- B: 전투 집중 (자가 버프)
- C: 마법탄 → 어그로 중간
- D: 보호막 → 탱커에게 쉴드
- **몬스터**: 주시 A → 단일 공격 (쉴드 일부 흡수)

### 턴 2 — 도발 쿨타임
- A: 기본 공격 (무기 어그로 보정으로 유지)
- B: 강타 → 딜 + 어그로 상승
- C: 집속 마법 차징 시작
- D: 치유 → 탱커 회복
- **몬스터**: 주시 A → 디버프 (방어력 감소)

### 턴 3 — 위기 발생
- A: 도발 (쿨 복귀) → 어그로 재확보
- B: 급소 찌르기 → 대성공! 크리티컬 → 어그로 75까지 급상승
- C: 집속 마법 발동 → 대량 딜
- D: 보호막 → 탱커에 (디버프 상태 대비)
- **몬스터**: A(85) vs B(75) → A 주시, 단일 공격 → A 아픔
- **HP 50% 진입** → *"크르르... 재미있군."* → 광폭화!

### 턴 4 — 광폭화 후
- A: 피해 분담 (전체 공격 대비)
- B: 기본 공격 (어그로 75라 강타 자제 — **어그로 시스템의 긴장감**)
- C: 마법탄 (꾸준히 딜)
- D: 치유 → 탱커 회복
- **몬스터**: 전체 공격 (광폭화 보정) → 피해 분담 발동, A가 많이 아픔

### 턴 5 — 클라이맥스
- A: 도발 → 어그로 재확보
- B: 전투 집중 (쿨 복귀)
- C: 마력 폭발 → 대량 딜 + **어그로 80 돌파!**
- D: 전체 치유 → 파티 회복
- **몬스터**: A(88) vs C(82) → 비례 확률 → **C에게 적중!**
- 스킬 딜러 위기 → 다음 턴 힐러의 대응이 관건

### 시뮬레이션 검증 결과
- ✅ 매 턴 모든 역할이 판단할 게 있음
- ✅ 어그로 시스템이 딜러의 자제/폭딜 판단을 유도
- ✅ 몬스터 HP 분기 연출이 전투의 극적 전환점을 만듦
- ✅ 기본 공격/방어 선택지가 "스킬 쿨타임 중의 빈 턴" 문제를 해결

---

## 12. 컨텐츠 구조

### 12.1 두 가지 모드

SS Engine의 컨텐츠는 **평소(상시)**와 **던전 오픈(이벤트)**으로 나뉜다.

| 모드 | 성격 | 플레이 방식 | 보상 |
|------|------|------------|------|
| **파견 (상시)** | 소탕/자동. 비동기. | 캐릭터 선택 → 파견지 선택 → 시간 후 수령 | 일반 재료 + 소량 포인트 |
| **던전 (이벤트)** | 각잡고 하는 실시간 탐사. | 4인 파티, VN 스타일 진행, 30분 | 일반 재료 + 특수 재료 + 전투 보상 |

---

### 12.2 파견 시스템 (상시 컨텐츠)

기존 Morgan CMS 파견 시스템(PIONEER_EXPEDITION.md)을 그대로 활용.

- 캐릭터 선택 → 파트너 선택 → 파견지 선택 → 스태미나 소모 → 시간 후 수령
- 유저 액션 최소화, 모바일 게임의 "소탕" 감각
- 스태미나 배분 딜레마: 건물 건설에 쓸지 vs 파견 보낼지
- 상세 기획은 `PIONEER_EXPEDITION.md` 참조

---

### 12.3 던전 시스템 (이벤트 컨텐츠)

#### 기본 개념

- **인스턴스 던전**: 확정된 맵 구조를 여러 파티가 각자 인스턴스로 진행
- **VN 스타일 진행**: 캐릭터가 서 있는 화면에 텍스트로 상황 전개
- **미니맵 시각화**: 아이작의 번제 스타일 미니맵으로 현재 위치/이동 가능 노드 표시
- **플레이타임**: 던전 1개 약 30분
- **컨텐츠 성격**: 상시가 아닌, 관리자가 특정 기간/시간대에 오픈하는 이벤트

#### 던전 오픈 흐름

```
[사전] 운영자가 던전을 여러 개 생성해둠
    ↓
[예고] 공지/이벤트/알람으로 "이번에 어떤 던전이 열린다" 힌트 제공
    ↓
[준비] 유저들이 힌트 기반으로 추측, 장비/스킬 세팅, 파티 구성
    ↓
[오픈] 던전 개방 → 유저들이 파티를 꾸려 입장
    ↓
[진행] 30분 내외의 실시간 탐사 + 전투
    ↓
[종료] 탈출 or 보스 클리어 → 보상 확정
```

오픈 주기는 관리자 재량. (주 1회, 격주, 시즌 이벤트 등 자유 설정)

#### 파티 모집

- **모집 로비 제공**: 모집 제목 설정, 빈 포지션 표시, 포지션별 참가
- **로비 채팅**: 캐입 채팅으로 사전 소통
- **유연한 구성**: 4명 풀파티로 바로 입장 가능 / 2명에서 나머지 모집도 가능
- **사전 합의 파티**: 기존 서사나 오너 간 합의로 미리 꾸려서 입장 가능

#### 맵 구조

- **노드 기반**: 방(노드)들이 통로로 연결된 구조
- **맵 크기**: 운영자가 설정 (15×15, 30×30 등 최대 크기 + 노드 수)
- **분기 존재**: 갈림길에서 방향 선택 가능 (최대 3갈래)
- **시야**: 던전 입장 시 전체 맵이 어두움 → 이동하며 밝혀감

**노드 종류:**

| 노드 | 설명 |
|------|------|
| 일반 전투 | 몬스터와 세미 턴제 전투 |
| 보스 전투 | 맵 끝의 보스. 특수 재료 드랍 |
| 이벤트 | 비전투 판정 이벤트 (함정, 상자, 발견 등) |
| 세이브 포인트 | 임시 소지품을 던전 밖으로 확정시키는 노드 |
| 탈출 이벤트 | 이 노드를 통해 던전에서 귀환 가능 |

#### 방향 선택

- 갈림길에서 선택지가 올라옴 (최대 3개)
- **3분 시간제한**, 캐입 채팅으로 파티원끼리 상의
- **다수결 결정**: 가장 많은 유저가 선택한 루트로 이동
- **2:2 동률**: 두 선택지 중 랜덤
- **정보 제공 없음**: 어느 방향에 뭐가 있는지 알 수 없음 (블라인드)

#### 이벤트 시스템

모든 이벤트는 **이벤트 라이브러리**에 독립적으로 등록되고, 던전 생성 시 매칭된다.

**이벤트 1개의 구성:**

| 필드 | 설명 | 예시 |
|------|------|------|
| 이벤트명 | 표시용 | "자물쇠에 잠긴 상자" |
| 이벤트 내용 | VN 텍스트 | "고대의 상자를 발견했다!" |
| 판정 스탯 | 체력 / 근력 / 마력 / 숙련 | 숙련 |
| 행동 방식 | 전원 참여(시간제한) / 1명 선택 | 1명 선택 |
| 시간 제한 | 행동 입력 제한 시간 (0 = 무제한) | 10초 |
| 대실패 결과 | 텍스트 + 효과 | "함정 발동!" / HP -30, 보상 없음 |
| 실패 결과 | 텍스트 + 효과 | "상자는 열었지만 파손" / 보상 50% |
| 성공 결과 | 텍스트 + 효과 | "깔끔하게 해제!" / 보상 100% |
| 대성공 결과 | 텍스트 + 효과 | "숨겨진 칸 발견!" / 보상 150% + 추가 |

**판정 4단계: 대실패 / 실패 / 성공 / 대성공**
- 100다이스 + 판정 스탯 보정으로 구간 결정
- 전투 판정 시스템과 동일한 구조

**이벤트 유형 예시:**

| 이벤트 | 행동 | 판정 스탯 | 대실패 | 실패 | 성공 | 대성공 |
|--------|------|----------|--------|------|------|--------|
| 함정 | 전원 회피 (10초) | 숙련 | HP -큼 | HP -중 | 무피해 | 무피해 + 함정 비활성화 |
| 잠긴 상자 | 1명 선택 | 숙련 | 함정 발동 HP- | 파손 보상 50% | 보상 100% | 보상 150% + 추가 |
| 무너진 통로 | 전원 참여 | 근력 | 통과 실패, 경로 차단 | 긁히며 통과 HP- | 통과 | 지름길 발견 |
| 독 가스 구간 | 전원 버티기 | 체력 | HP -큼 + 독 상태 | HP -중 | HP -소 | 무피해 |
| 고대 서적 | 1명 선택 | 마력 | 해독 실패 | 일부 해독, 버프 약 | 해독 성공, 버프 | 완전 해독, 강버프 |
| 소지품 발송 | 자동 (세이브) | 없음 | — | — | 현재 임시 소지품 확정 | — |

**CMS 기본 제공**: 20~30개의 기본 이벤트 세트를 제공. 운영자가 추가 등록 가능.

#### 임시 소지 시스템

- 던전 내에서 얻은 재화/아이템은 **임시 소지** 상태
- 임시 소지품은 인벤토리에 들어가지 않음
- **확정 조건**:
  - 탈출 이벤트 노드를 통해 귀환
  - 보스 클리어 후 귀환
  - 세이브 포인트 노드에서 사전 발송
- **소실 조건**:
  - 전멸 (4명 전원 HP 0) → 임시 소지품 전부 소실 + 던전 강제 종료

#### HP 0 / 전멸 처리

| 상황 | 처리 |
|------|------|
| 전투 중 HP 0 | 해당 전투에서 행동 불가 |
| 전투 승리 후 | HP 0이었던 캐릭터는 **HP 1**로 부활 |
| HP 회복 | 아이템 또는 회복 이벤트로 HP 회복 후 다음 전투 참가 |
| **전멸 (4명 전원 HP 0)** | 던전 강제 종료 + 임시 소지품 **전부 소실** |

#### 중간 이탈 처리

- 4명 중 1명 이탈 시: **5분 대기**
- 5분 내 미복귀 시: 현재까지의 임시 소지품을 가지고 **전원 귀환 처리**
- 이벤트성 컨텐츠이므로 충분한 사전 준비 후 참가할 것을 전제

#### 던전 생성 및 관리

```
[1] 운영자가 이벤트 라이브러리에 이벤트 등록 (1회성 작업, 재활용 가능)
    ↓
[2] 던전 생성 화면에서 설정
    ├── 맵 크기 (최대 그리드 + 노드 수)
    ├── 이벤트 풀 선택 ("이 던전에는 이 이벤트들을 사용")
    ├── 노드 종류 비율 설정 (전투 40%, 이벤트 40%, 빈 칸 20% 등)
    ├── 보스 몬스터 선택
    └── 탈출 노드 / 세이브 노드 수
    ↓
[3] "생성" → 랜덤으로 맵 자동 생성
    ├── 시작점 → 보스까지 도달 가능 경로 보장 (알고리즘 검증)
    └── 마음에 안 들면 재생성 가능
    ↓
[4] "확정" → 이 구조로 던전 등록
    ↓
[5] 오픈 일정 설정 → 유저에게 공개
```

- 매 입장마다 맵이 바뀌는 것이 아님
- **확정된 맵**을 여러 파티가 동일한 구조로 인스턴스 진행
- 커스텀 맵 에디터는 추후 피드백 시 추가 검토

#### 맵 정보 공유 (유저 간)

- 시스템 자동 공유 **아님**
- 먼저 탈출구를 찾은 파티가 커뮤니티(게시판, 채팅)에서 정보 공유
- 다른 파티는 이 정보를 기반으로 안전한 파밍 루트 구성
- **서사 소재로 활용**: "우리 파티가 발견한 탈출 루트 보고서", 악역 캐릭터가 "탈출구 위치를 판다!" 등

---

### 12.4 재료 체계

| 재료 구분 | 획득처 | 용도 |
|----------|--------|------|
| **일반 재료** | 파견(상시) + 던전 드랍 + 상점 구매 | 건설, 연구, 일반 소모 |
| **특수 재료** | 던전 보스 전용 드랍 | 특정 연구, 상위 시설 건축 |
| **소모 아이템** (HP 회복 등) | 상점 구매 + 파견 보상 | 던전 내 사용 |

#### 인벤토리 제한

- 초기 인벤토리 슬롯을 **빡세게** 설정
- 파견으로 넉넉히 모아도 던전에 들고 갈 수 있는 양에 제한
- **확장 수단**: 연구 완료 / 시설 건설(창고) / 상점 아이템
- 인벤토리 확장 자체가 성장 동기이자 재화 싱크

---

### 12.5 기타 컨텐츠

| 항목 | 결정 |
|------|------|
| **PvP** | 없음 |
| **반복 컨텐츠** | 파견(상시) + 건설 + 연구가 일상 루프 |
| **시즌 구조** | 관리자 재량 — 누적형(기존 던전 유지 + 신규 추가) or 교체형(새 던전으로 교체) |

### 12.6 전체 순환 구조

```
[평소 — 상시 루프]
창작활동 → 포인트 획득 → 스탯/스킬/장비/소모품 구매
파견 → 일반 재료 획득 → 건설/연구 진행
                ↓
[던전 오픈 — 이벤트]
사전 힌트 → 파티 구성 → 던전 입장
    ↓
탐사(이벤트 판정) + 전투(세미 턴제) → 일반 재료 + 특수 재료 획득
    ↓
탈출 or 보스 클리어 → 보상 확정
    ↓
[돌아와서]
특수 재료 → 상위 연구/시설 해금 → 인벤 확장 등 성장
전투 로그 → 서사 아카이빙 → 창작 소재
정보 공유 → 커뮤니티 소통 → 다음 던전 대비
```

---

## 13. CMS 연동 사항

### Morgan CMS 기존 시스템 활용

| CMS 시스템 | SS Engine 연동 |
|-----------|---------------|
| 캐릭터 시스템 | 전투 캐릭터 = CMS 캐릭터 (스탯 추가) |
| 포인트 시스템 | 스탯/스킬/장비 구매 재화 |
| 재료 시스템 | 전투 드랍 재료 → 개척 투입 |
| 상점 시스템 | 스킬/장비/소모품 판매 |
| 연구 시스템 | 스킬 슬롯 확장 등 |
| 게시판 시스템 | 전투 로그 자동 저장 → 서사 아카이빙 |

### 전투 로그
- 모든 행동은 로그로 자동 저장
- 게시판과 연동하여 아카이빙
- 서사 컨텐츠 / 창작 소재로 활용 가능
- (VN Engine 연동 시 전투 리플레이도 가능)

---

## 14. 개발 우선순위

```
[1단계] 코어 전투 시스템
├── 스탯/장비 데이터 구조
├── 턴 진행 로직 (PHP)
├── 100다이스 판정 (4단계: 대실패/실패/성공/대성공)
├── 어그로 시스템
├── 기본 스킬 세트 (역할별 3~4개)
└── Supabase 연동 (실시간 상태 동기화)

[2단계] 몬스터 & 전투 UI
├── 몬스터 등록/관리 (운영자용)
├── 랜덤 패턴 + HP 조건 분기
├── 전투 UI (VN 스타일 + 행동 선택 + 로그 + 주시 표시)
└── 전투 로그 자동 저장

[3단계] 던전 시스템
├── 이벤트 라이브러리 (관리자 등록 + CMS 기본 제공 20~30개)
├── 던전 생성기 (비율 설정 → 랜덤 생성 → 확정)
├── 미니맵 시각화 (노드 기반)
├── 방향 선택 + 다수결 로직
├── 임시 소지 / 세이브 / 탈출 시스템
├── 파티 모집 로비 + 로비 채팅
├── 던전 내 캐입 채팅
└── HP 0 / 전멸 / 중간 이탈 처리

[4단계] 보상 연동
├── 일반 재료 / 특수 재료 드랍 테이블
├── 인벤토리 제한 + 확장 연동
├── 장비/스킬 상점 연동
└── 파견 시스템과 재료 풀 통합

[5단계] 확장
├── 운영자 커스텀 스킬 에디터
├── 턴별 스크립트 몬스터
├── 커스텀 맵 에디터 (피드백 시)
├── 악세서리 슬롯
└── 추가 스킬/장비
```

---

*버전: 2.0*
*업데이트: 12. 컨텐츠 구조 확정 (던전/파견/이벤트/재료 체계)*
*다음 작업: 밸런싱 수치 조정 (어그로 감소량, 스킬 계수, 판정 구간 등)*
