# 진영 시스템 (Faction System)

> 진영별 익명망 + 카드 오토배틀 + 점령전 + 해킹/정보전
> 2차 작업. SS Engine과 별개로 독립 진행 가능.
> 최종 업데이트: 2026-02-15

---

## 개요

진영 간 정보전·정치·암투를 핵심 재미로 하는 대립 컨텐츠.
전투 자체는 가볍게(카드 오토배틀), 전투 바깥의 전략과 심리전에 무게를 둔다.

**핵심 루프:**
```
익명망에서 전략 논의
  → 카드 수집 & 덱 구성
  → 점령전 전투 (금토일 등, 관리자 설정)
  → 점령도 축적 → 시즌 종료 시 영토 확정
  → 해킹으로 상대 정보 탈취 시도 ↔ 방어 아이템으로 차단
  → 다시 익명망에서 정보 공유 & 전략 수정
```

**의존성:**
- mg_side (세력) — 이미 구현됨
- 상점 시스템 (mg_shop_*) — 이미 구현됨
- 포인트 시스템 — 이미 구현됨
- 익명망 — 이 문서에서 함께 설계

---

## 1. 익명망 (Anonymous Network)

> 듀라라라 "다라즈" 컨셉. 진영별 비밀 게시판 + 코드네임.

### 1.1 코드네임

- 진영별 접두어 + 번호 (예: "색욕 03", "떠도는 개 01", "요원 07")
- 접두어 카테고리는 관리자가 진영별로 등록
- 캐릭터 1개당 코드네임 1개, 시즌마다 리셋
- 코드네임 ↔ 실제 캐릭터 매핑은 시스템만 알고 있음 (관리자도 확인 가능)

### 1.2 진영별 게시판

- 자기 진영 게시판만 접근 가능 (기본)
- 해킹 성공 시 30분간 타 진영 열람/작성 가능
- 진영별 UI 테마 (관리자 설정: 색상, 분위기 텍스트 등)

### 1.3 시즌

- 관리자가 시즌 생성 (기간 설정)
- 시즌 시작 시 코드네임 전체 리셋 + 자동 재할당
- 시즌 종료 시 점령 결과 확정 + 보상 지급
- 시즌 간 공백기 = 서사 소화 기간 + 관리자 준비 기간 (카드, 점령지 세팅)

### 1.4 NPC 운영

- 관리자가 진영별 NPC 코드네임으로 활동 가능
- 분위기 조성, 신규 환영, 이벤트 떡밥 투척, 갈등 중재

---

## 2. 카드 배틀 (Card Auto-Battle)

> 확산성 밀리언아서 스타일. 5장 오토배틀러 + 가위바위보 상성.

### 2.1 카드 기본

- 관리자가 카드 등록 (이름, 이미지, 타입, 수치, 레어리티)
- 3가지 타입 (가위바위보 상성):

| 타입 | 강점 (상대가 이 타입일 때) | 약점 |
|------|--------------------------|------|
| 공격 | vs 회복 → 추가 피해 | vs 방어 → 카운터당함 |
| 방어 | vs 공격 → 카운터 | vs 회복 → 불리 |
| 회복 | vs 방어 → 집중 회복 (회복량 증가) | vs 공격 → 추가 피해 |

- 카드마다 기본 수치 (공격력, 방어력, 회복량 등)
- 레어리티에 따른 수치 차이

### 2.2 카드 획득

- **진영 상점**에서 포인트로 뽑기 (랜덤 가챠)
- 기존 mg_shop 시스템 활용 또는 별도 진영 상점
- 포인트 소모처 역할 (의도된 설계)
- 중복 카드 처리 (분해 → 소량 포인트 반환? 강화 재료?)

### 2.3 덱 구성

- **공격 덱** (5장) — 내가 전투를 걸 때 사용
- **방어 덱** (5장) — 타인이 나에게 전투를 걸어올 때 사용
- 각각 별도 설정, 언제든 변경 가능
- 5장 배치 순서가 전투 순서 (1번 vs 1번, 2번 vs 2번 ... 5번 vs 5번)

### 2.4 전투 판정

- 오토배틀: 서버에서 즉시 판정, 결과만 보여줌
- 5라운드 진행, 각 라운드 카드 1장씩 대결
- 상성 + 수치로 라운드 승패 결정
- 3라운드 이상 승리한 쪽이 전투 승리

---

## 3. 점령전 (Territory Conquest)

> 시즌 기반 영토 쟁탈. 점령도 누적 → 시즌 종료 시 확정.

### 3.1 맵

- 관리자가 맵 이미지 등록
- 맵 위에 지역(영토) 등록 (이름, 좌표/영역, 초기 소유 진영)
- 지역 종류:
  - **본진** — 진영별 1개, 절대 지목 불가 (안전장치)
  - **점령지** — 소유 진영이 있는 지역 (빼앗기 가능)
  - **미점령지** — 소유 진영 없음 (쟁탈 대상)

### 3.2 점령 흐름

1. 시즌 시작 → 초기 맵 상태 설정 (진영별 본진 + 미점령지)
2. 전투 기간 동안 점령도 누적:
   - 공격 승리: 점령도 +N (예: 3)
   - 방어 승리: 점령도 +M (예: 1)
3. 시즌 종료 → 각 미점령지/쟁탈지에서 가장 높은 점령도를 가진 진영이 획득
4. 점령한 지역 수에 따라 진영 보너스 (출석 포인트 증가 등)

### 3.3 전투 스케줄

- **관리자가 설정** (요일, 시간대, 일일 횟수 제한)
- 예시: 금토일 21:00~22:00, 1일 5회
- 이벤트 개념 — 사전 공지 후 진행
- 위젯으로 다음 전투 일정 표시

### 3.4 점령도 표시

- **자기 진영의 점령도만 보임** (핵심 — 정보 비대칭)
- 다른 진영 점령도는 해킹으로만 확인 가능
- 점령 현황 게시판 or 위젯에서 표시

### 3.5 시즌 종료 & 다음 전장

- 시즌 승리 진영 유저들에게 **투표권** 부여
- 다음 시즌 전장(쟁탈 대상 지역) 선택 투표
- 상대 본진은 선택 불가, 그 외 모든 점령지 지목 가능
- 관리자가 새 미점령지를 추가하는 것도 가능

---

## 4. 해킹 / 정보전 (Hacking & Espionage)

> 상점 아이템으로 해킹 진척도 올려서 상대 익명망 침투.

### 4.1 해킹 메커니즘

- 상점에서 **"OO진영 암호화 샤드"** 등의 해킹 아이템 판매
- 구매 시 해당 진영에 대한 **해킹 진척도** +N (진영 단위 누적)
- 진척도 100 도달 → **30분간 해당 진영 익명망 접근 허용**
  - 열람, 글 작성, 댓글 가능
  - 해당 진영 점령도 확인 가능
- 30분 경과 후 접근 차단 + 진척도 리셋

### 4.2 방어 메커니즘

- **"방화벽 강화"** 등의 방어 아이템 판매
- 구매 시 자기 진영에 대한 해킹 진척도 -N
- **방어 아이템은 해킹 아이템보다 비쌈** (의도된 밸런스)
  - 해킹: 꾸준히 싸게 깎아먹기
  - 방어: 90%대에서 비싼 돈 주고 긴급 방어
  - 밸런스는 실제 운영하면서 조정

### 4.3 정보전 흐름 (예시)

```
A진영 익명망: "B진영이 전투 승률 높은 것 같다, 점령도 확인 필요"
  → A진영 유저들이 B진영 해킹 아이템 구매
  → 진척도 80... 90...
  → B진영 익명망: "A진영이 우리 해킹 중! 방어 아이템 사자"
  → B진영 방어 아이템 구매 → 진척도 85로 떨어짐
  → 한편 C진영은 조용히 전투 보조 아이템에 올인 → 점령도 급상승
```

---

## 5. 날씨 / 환경 시스템 (밸런싱)

> 진영 간 인원 불균형을 자연스럽게 보정.

### 5.1 개념

- 관리자가 날씨/환경 타입 등록 (이름, 설명, 효과)
- 각 진영마다 **유리한 날씨** 설정 가능
- 전투 오픈 시 날씨 설정 (수동 또는 확률 기반 자동)
- 날씨에 따라 특정 진영에 전투 버프 (카드 수치 보정 등)

### 5.2 운영 의도

- 소수 진영에 유리한 날씨를 자주 출현시켜 자연스럽게 보정
- 유저 입장에서는 "오늘 날씨가 우리에게 유리하다!" → RP 자연스러움
- 노골적인 언더독 버프 대신 세계관 설정으로 포장

### 5.3 위젯

- 메인/점령 게시판에 현재 날씨 위젯 표시
- "오늘의 전장 환경: 🌙 월식 — 뱀파이어 진영 전투력 10% 증가"

---

## 6. 상점 연동 (포인트 소모처)

| 아이템 분류 | 예시 | 효과 |
|-------------|------|------|
| 카드 뽑기 | 전투 카드 팩 | 랜덤 카드 획득 |
| 해킹 아이템 | OO진영 암호화 샤드 | 대상 진영 해킹 진척도 +N |
| 방어 아이템 | 방화벽 강화 키트 | 자기 진영 해킹 진척도 -N (비쌈) |
| 전투 보조 | 전투 부스터 | 다음 전투 카드 수치 일시 보정 |
| 정보 아이템 | 첩보 보고서 | 특정 유저의 공개 전적 열람 등 |

---

## 7. DB 설계 초안

### 익명망

| 테이블 | 용도 |
|--------|------|
| mg_anon_season | 시즌 (기간, 활성 여부) |
| mg_anon_codename | 코드네임 할당 (시즌×캐릭터×진영) |
| mg_anon_codename_prefix | 진영별 코드네임 접두어 카테고리 |

※ 익명 게시판 자체는 기존 그누보드 게시판 + 접근 제어로 구현 가능

### 카드 배틀

| 테이블 | 용도 |
|--------|------|
| mg_card | 카드 정의 (이름, 타입, 수치, 레어리티, 이미지) |
| mg_card_own | 유저별 카드 보유 |
| mg_card_deck | 덱 (mb_id, deck_type[attack/defense], slot 1~5, card_id) |
| mg_battle_log | 전투 기록 (공격자, 방어자, 라운드별 결과, 승패) |

### 점령전

| 테이블 | 용도 |
|--------|------|
| mg_territory_map | 맵 (이미지, 시즌 연결) |
| mg_territory | 지역 (맵 ID, 이름, 좌표, 타입[본진/점령/미점령], 소유 진영) |
| mg_conquest | 점령도 (시즌, 지역 ID, 진영 ID, 점령도 수치) |
| mg_conquest_season | 시즌 설정 (기간, 전투 스케줄, 상태) |
| mg_conquest_vote | 다음 전장 투표 (시즌, mb_id, 선택 지역) |

### 해킹

| 테이블 | 용도 |
|--------|------|
| mg_hack_progress | 해킹 진척도 (공격 진영 → 대상 진영, 현재 수치) |
| mg_hack_log | 해킹/방어 아이템 사용 이력 |
| mg_hack_breach | 해킹 성공 기록 (시작 시각, 종료 시각, 접근 허용 진영) |

### 날씨

| 테이블 | 용도 |
|--------|------|
| mg_weather | 날씨 타입 (이름, 설명, 효과 JSON) |
| mg_weather_side_buff | 날씨 × 진영 버프 매핑 |
| mg_battle_schedule | 전투 일정 (날짜, 시간, 적용 날씨, 대상 지역) |

---

## 8. 연동 사항

| 기존 시스템 | 연동 |
|-------------|------|
| mg_side (세력) | 진영 = 세력. 기존 테이블 그대로 활용 |
| mg_shop_* (상점) | 카드팩, 해킹/방어 아이템 판매 |
| mg_character (캐릭터) | 코드네임 매핑, 덱 소유, 전투 참여 |
| 포인트 시스템 | 카드 뽑기·아이템 구매 소모처, 점령 보상 |
| 출석 시스템 | 점령 지역 수에 따른 출석 포인트 보너스 |
| 알림 시스템 | 해킹 경고, 전투 결과, 시즌 종료 알림 |
| 메인 위젯 | 날씨, 전투 일정, 점령 현황 위젯 |

---

## 9. 밸런싱 메모

- 해킹 아이템 < 방어 아이템 가격 (방어가 더 비쌈)
- 날씨로 소수 진영 보정 (관리자 개입 or 확률 가중)
- 공격 승리 점령도 > 방어 승리 점령도
- 카드 뽑기 확률, 레어리티별 수치 차이 → 실운영 데이터 보면서 조정
- 시즌 길이, 전투 횟수 제한 → 관리자 설정으로 유연하게

---

## 10. 구현 우선순위 (제안)

1. 익명망 (코드네임 + 진영 게시판) — 전투 없이도 독립 운영 가능
2. 카드 시스템 (등록, 뽑기, 덱) — 상점 연동
3. 전투 판정 (오토배틀) — 카드 있어야 의미 있음
4. 점령전 (맵, 지역, 점령도, 시즌) — 전투 위에 얹는 메타 게임
5. 해킹/정보전 — 익명망 + 점령전 위에 얹는 레이어
6. 날씨/환경 — 밸런싱 도구, 가장 마지막

---

*이 문서는 2차 작업 기획 초안입니다. 구현 시 상세 DB 스키마와 API는 별도 설계.*
